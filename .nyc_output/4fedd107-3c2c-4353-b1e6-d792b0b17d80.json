{"/Users/jim/git/oss/machina/src/BehavioralFsm.js":{"path":"/Users/jim/git/oss/machina/src/BehavioralFsm.js","statementMap":{"0":{"start":{"line":3,"column":51},"end":{"line":3,"column":355}},"1":{"start":{"line":3,"column":126},"end":{"line":3,"column":181}},"2":{"start":{"line":3,"column":160},"end":{"line":3,"column":178}},"3":{"start":{"line":3,"column":191},"end":{"line":3,"column":353}},"4":{"start":{"line":3,"column":225},"end":{"line":3,"column":350}},"5":{"start":{"line":3,"column":356},"end":{"line":3,"column":376}},"6":{"start":{"line":5,"column":8},"end":{"line":5,"column":25}},"7":{"start":{"line":7,"column":12},"end":{"line":7,"column":30}},"8":{"start":{"line":9,"column":14},"end":{"line":9,"column":34}},"9":{"start":{"line":11,"column":22},"end":{"line":11,"column":38}},"10":{"start":{"line":13,"column":13},"end":{"line":13,"column":32}},"11":{"start":{"line":15,"column":19},"end":{"line":15,"column":32}},"12":{"start":{"line":18,"column":2},"end":{"line":18,"column":26}},"13":{"start":{"line":20,"column":2},"end":{"line":20,"column":56}},"14":{"start":{"line":22,"column":2},"end":{"line":22,"column":41}},"15":{"start":{"line":24,"column":2},"end":{"line":24,"column":45}},"16":{"start":{"line":27,"column":0},"end":{"line":310,"column":26}},"17":{"start":{"line":30,"column":23},"end":{"line":30,"column":40}},"18":{"start":{"line":32,"column":4},"end":{"line":34,"column":5}},"19":{"start":{"line":33,"column":6},"end":{"line":33,"column":72}},"20":{"start":{"line":36,"column":4},"end":{"line":38,"column":5}},"21":{"start":{"line":37,"column":6},"end":{"line":37,"column":90}},"22":{"start":{"line":40,"column":4},"end":{"line":40,"column":42}},"23":{"start":{"line":43,"column":22},"end":{"line":43,"column":43}},"24":{"start":{"line":46,"column":4},"end":{"line":52,"column":7}},"25":{"start":{"line":49,"column":6},"end":{"line":51,"column":7}},"26":{"start":{"line":50,"column":8},"end":{"line":50,"column":28}},"27":{"start":{"line":54,"column":4},"end":{"line":58,"column":5}},"28":{"start":{"line":55,"column":6},"end":{"line":55,"column":73}},"29":{"start":{"line":56,"column":6},"end":{"line":56,"column":64}},"30":{"start":{"line":57,"column":6},"end":{"line":57,"column":73}},"31":{"start":{"line":60,"column":4},"end":{"line":60,"column":17}},"32":{"start":{"line":63,"column":4},"end":{"line":65,"column":5}},"33":{"start":{"line":64,"column":6},"end":{"line":64,"column":58}},"34":{"start":{"line":67,"column":4},"end":{"line":67,"column":54}},"35":{"start":{"line":69,"column":4},"end":{"line":72,"column":5}},"36":{"start":{"line":70,"column":6},"end":{"line":70,"column":87}},"37":{"start":{"line":71,"column":6},"end":{"line":71,"column":30}},"38":{"start":{"line":74,"column":4},"end":{"line":74,"column":48}},"39":{"start":{"line":77,"column":4},"end":{"line":82,"column":5}},"40":{"start":{"line":78,"column":6},"end":{"line":81,"column":9}},"41":{"start":{"line":84,"column":4},"end":{"line":88,"column":6}},"42":{"start":{"line":94,"column":16},"end":{"line":94,"column":29}},"43":{"start":{"line":96,"column":16},"end":{"line":96,"column":24}},"44":{"start":{"line":98,"column":4},"end":{"line":100,"column":5}},"45":{"start":{"line":99,"column":6},"end":{"line":99,"column":42}},"46":{"start":{"line":102,"column":4},"end":{"line":102,"column":66}},"47":{"start":{"line":105,"column":4},"end":{"line":105,"column":33}},"48":{"start":{"line":109,"column":19},"end":{"line":109,"column":24}},"49":{"start":{"line":111,"column":4},"end":{"line":113,"column":5}},"50":{"start":{"line":112,"column":6},"end":{"line":112,"column":131}},"51":{"start":{"line":115,"column":4},"end":{"line":121,"column":5}},"52":{"start":{"line":116,"column":6},"end":{"line":120,"column":8}},"53":{"start":{"line":123,"column":21},"end":{"line":123,"column":50}},"54":{"start":{"line":124,"column":15},"end":{"line":124,"column":47}},"55":{"start":{"line":126,"column":4},"end":{"line":128,"column":5}},"56":{"start":{"line":127,"column":6},"end":{"line":127,"column":34}},"57":{"start":{"line":130,"column":4},"end":{"line":130,"column":49}},"58":{"start":{"line":131,"column":23},"end":{"line":131,"column":39}},"59":{"start":{"line":132,"column":19},"end":{"line":132,"column":44}},"60":{"start":{"line":134,"column":21},"end":{"line":134,"column":26}},"61":{"start":{"line":136,"column":4},"end":{"line":185,"column":5}},"62":{"start":{"line":137,"column":6},"end":{"line":137,"column":48}},"63":{"start":{"line":139,"column":6},"end":{"line":184,"column":7}},"64":{"start":{"line":140,"column":8},"end":{"line":140,"column":64}},"65":{"start":{"line":141,"column":8},"end":{"line":141,"column":34}},"66":{"start":{"line":142,"column":8},"end":{"line":144,"column":10}},"67":{"start":{"line":147,"column":8},"end":{"line":147,"column":49}},"68":{"start":{"line":149,"column":8},"end":{"line":151,"column":9}},"69":{"start":{"line":150,"column":10},"end":{"line":150,"column":58}},"70":{"start":{"line":153,"column":8},"end":{"line":153,"column":78}},"71":{"start":{"line":154,"column":8},"end":{"line":154,"column":41}},"72":{"start":{"line":155,"column":8},"end":{"line":155,"column":74}},"73":{"start":{"line":156,"column":8},"end":{"line":156,"column":70}},"74":{"start":{"line":157,"column":8},"end":{"line":157,"column":42}},"75":{"start":{"line":158,"column":27},"end":{"line":162,"column":10}},"76":{"start":{"line":164,"column":8},"end":{"line":179,"column":9}},"77":{"start":{"line":165,"column":10},"end":{"line":167,"column":28}},"78":{"start":{"line":169,"column":10},"end":{"line":169,"column":51}},"79":{"start":{"line":171,"column":10},"end":{"line":176,"column":11}},"80":{"start":{"line":172,"column":12},"end":{"line":172,"column":80}},"81":{"start":{"line":174,"column":12},"end":{"line":174,"column":29}},"82":{"start":{"line":175,"column":12},"end":{"line":175,"column":45}},"83":{"start":{"line":178,"column":10},"end":{"line":178,"column":50}},"84":{"start":{"line":181,"column":8},"end":{"line":181,"column":58}},"85":{"start":{"line":182,"column":8},"end":{"line":182,"column":38}},"86":{"start":{"line":183,"column":8},"end":{"line":183,"column":49}},"87":{"start":{"line":187,"column":4},"end":{"line":187,"column":18}},"88":{"start":{"line":191,"column":21},"end":{"line":191,"column":50}},"89":{"start":{"line":192,"column":19},"end":{"line":192,"column":35}},"90":{"start":{"line":193,"column":22},"end":{"line":193,"column":43}},"91":{"start":{"line":194,"column":22},"end":{"line":194,"column":43}},"92":{"start":{"line":196,"column":15},"end":{"line":196,"column":56}},"93":{"start":{"line":198,"column":4},"end":{"line":241,"column":5}},"94":{"start":{"line":199,"column":6},"end":{"line":235,"column":7}},"95":{"start":{"line":200,"column":8},"end":{"line":200,"column":46}},"96":{"start":{"line":202,"column":8},"end":{"line":208,"column":9}},"97":{"start":{"line":203,"column":10},"end":{"line":203,"column":42}},"98":{"start":{"line":205,"column":10},"end":{"line":205,"column":49}},"99":{"start":{"line":207,"column":10},"end":{"line":207,"column":43}},"100":{"start":{"line":210,"column":8},"end":{"line":210,"column":48}},"101":{"start":{"line":211,"column":8},"end":{"line":211,"column":41}},"102":{"start":{"line":212,"column":8},"end":{"line":212,"column":36}},"103":{"start":{"line":213,"column":27},"end":{"line":217,"column":10}},"104":{"start":{"line":218,"column":8},"end":{"line":218,"column":51}},"105":{"start":{"line":220,"column":8},"end":{"line":222,"column":9}},"106":{"start":{"line":221,"column":10},"end":{"line":221,"column":84}},"107":{"start":{"line":224,"column":8},"end":{"line":224,"column":53}},"108":{"start":{"line":226,"column":8},"end":{"line":228,"column":9}},"109":{"start":{"line":227,"column":10},"end":{"line":227,"column":41}},"110":{"start":{"line":230,"column":8},"end":{"line":232,"column":9}},"111":{"start":{"line":231,"column":10},"end":{"line":231,"column":60}},"112":{"start":{"line":234,"column":8},"end":{"line":234,"column":15}},"113":{"start":{"line":237,"column":6},"end":{"line":240,"column":10}},"114":{"start":{"line":244,"column":21},"end":{"line":244,"column":50}},"115":{"start":{"line":245,"column":20},"end":{"line":245,"column":90}},"116":{"start":{"line":247,"column":4},"end":{"line":259,"column":5}},"117":{"start":{"line":248,"column":19},"end":{"line":252,"column":7}},"118":{"start":{"line":253,"column":6},"end":{"line":253,"column":41}},"119":{"start":{"line":254,"column":25},"end":{"line":257,"column":8}},"120":{"start":{"line":258,"column":6},"end":{"line":258,"column":47}},"121":{"start":{"line":262,"column":4},"end":{"line":262,"column":49}},"122":{"start":{"line":263,"column":4},"end":{"line":263,"column":39}},"123":{"start":{"line":266,"column":21},"end":{"line":266,"column":50}},"124":{"start":{"line":268,"column":19},"end":{"line":270,"column":5}},"125":{"start":{"line":269,"column":6},"end":{"line":269,"column":79}},"126":{"start":{"line":272,"column":20},"end":{"line":272,"column":61}},"127":{"start":{"line":274,"column":4},"end":{"line":274,"column":75}},"128":{"start":{"line":276,"column":4},"end":{"line":278,"column":18}},"129":{"start":{"line":277,"column":6},"end":{"line":277,"column":58}},"130":{"start":{"line":281,"column":21},"end":{"line":281,"column":50}},"131":{"start":{"line":283,"column":4},"end":{"line":297,"column":5}},"132":{"start":{"line":284,"column":6},"end":{"line":284,"column":33}},"133":{"start":{"line":287,"column":6},"end":{"line":289,"column":9}},"134":{"start":{"line":288,"column":8},"end":{"line":288,"column":59}},"135":{"start":{"line":292,"column":19},"end":{"line":294,"column":7}},"136":{"start":{"line":293,"column":8},"end":{"line":293,"column":44}},"137":{"start":{"line":296,"column":6},"end":{"line":296,"column":70}},"138":{"start":{"line":300,"column":21},"end":{"line":300,"column":50}},"139":{"start":{"line":301,"column":16},"end":{"line":301,"column":32}},"140":{"start":{"line":302,"column":16},"end":{"line":302,"column":79}},"141":{"start":{"line":304,"column":4},"end":{"line":306,"column":5}},"142":{"start":{"line":305,"column":6},"end":{"line":305,"column":56}},"143":{"start":{"line":308,"column":4},"end":{"line":308,"column":17}},"144":{"start":{"line":312,"column":0},"end":{"line":312,"column":36}},"145":{"start":{"line":313,"column":0},"end":{"line":313,"column":31}}},"fnMap":{"0":{"name":"_typeof","decl":{"start":{"line":3,"column":9},"end":{"line":3,"column":16}},"loc":{"start":{"line":3,"column":22},"end":{"line":3,"column":378}},"line":3},"1":{"name":"_typeof","decl":{"start":{"line":3,"column":145},"end":{"line":3,"column":152}},"loc":{"start":{"line":3,"column":158},"end":{"line":3,"column":180}},"line":3},"2":{"name":"_typeof","decl":{"start":{"line":3,"column":210},"end":{"line":3,"column":217}},"loc":{"start":{"line":3,"column":223},"end":{"line":3,"column":352}},"line":3},"3":{"name":"BehavioralFsm","decl":{"start":{"line":17,"column":9},"end":{"line":17,"column":22}},"loc":{"start":{"line":17,"column":32},"end":{"line":25,"column":1}},"line":17},"4":{"name":"initialize","decl":{"start":{"line":28,"column":23},"end":{"line":28,"column":33}},"loc":{"start":{"line":28,"column":36},"end":{"line":28,"column":38}},"line":28},"5":{"name":"initClient","decl":{"start":{"line":29,"column":23},"end":{"line":29,"column":33}},"loc":{"start":{"line":29,"column":42},"end":{"line":41,"column":3}},"line":29},"6":{"name":"configForState","decl":{"start":{"line":42,"column":27},"end":{"line":42,"column":41}},"loc":{"start":{"line":42,"column":52},"end":{"line":61,"column":3}},"line":42},"7":{"name":"(anonymous_7)","decl":{"start":{"line":46,"column":27},"end":{"line":46,"column":28}},"loc":{"start":{"line":48,"column":6},"end":{"line":52,"column":5}},"line":48},"8":{"name":"ensureClientMeta","decl":{"start":{"line":62,"column":29},"end":{"line":62,"column":45}},"loc":{"start":{"line":62,"column":54},"end":{"line":75,"column":3}},"line":62},"9":{"name":"buildEventPayload","decl":{"start":{"line":76,"column":30},"end":{"line":76,"column":47}},"loc":{"start":{"line":76,"column":62},"end":{"line":89,"column":3}},"line":76},"10":{"name":"getHandlerArgs","decl":{"start":{"line":90,"column":27},"end":{"line":90,"column":41}},"loc":{"start":{"line":90,"column":60},"end":{"line":103,"column":3}},"line":90},"11":{"name":"getSystemHandlerArgs","decl":{"start":{"line":104,"column":33},"end":{"line":104,"column":53}},"loc":{"start":{"line":104,"column":68},"end":{"line":106,"column":3}},"line":104},"12":{"name":"handle","decl":{"start":{"line":108,"column":19},"end":{"line":108,"column":25}},"loc":{"start":{"line":108,"column":41},"end":{"line":188,"column":3}},"line":108},"13":{"name":"transition","decl":{"start":{"line":190,"column":23},"end":{"line":190,"column":33}},"loc":{"start":{"line":190,"column":52},"end":{"line":242,"column":3}},"line":190},"14":{"name":"deferUntilTransition","decl":{"start":{"line":243,"column":33},"end":{"line":243,"column":53}},"loc":{"start":{"line":243,"column":73},"end":{"line":260,"column":3}},"line":243},"15":{"name":"deferAndTransition","decl":{"start":{"line":261,"column":31},"end":{"line":261,"column":49}},"loc":{"start":{"line":261,"column":69},"end":{"line":264,"column":3}},"line":261},"16":{"name":"processQueue","decl":{"start":{"line":265,"column":25},"end":{"line":265,"column":37}},"loc":{"start":{"line":265,"column":46},"end":{"line":279,"column":3}},"line":265},"17":{"name":"filterFn","decl":{"start":{"line":268,"column":28},"end":{"line":268,"column":36}},"loc":{"start":{"line":268,"column":43},"end":{"line":270,"column":5}},"line":268},"18":{"name":"(anonymous_18)","decl":{"start":{"line":276,"column":22},"end":{"line":276,"column":23}},"loc":{"start":{"line":276,"column":38},"end":{"line":278,"column":5}},"line":276},"19":{"name":"clearQueue","decl":{"start":{"line":280,"column":23},"end":{"line":280,"column":33}},"loc":{"start":{"line":280,"column":48},"end":{"line":298,"column":3}},"line":280},"20":{"name":"(anonymous_20)","decl":{"start":{"line":287,"column":36},"end":{"line":287,"column":37}},"loc":{"start":{"line":287,"column":52},"end":{"line":289,"column":7}},"line":287},"21":{"name":"filter","decl":{"start":{"line":292,"column":28},"end":{"line":292,"column":34}},"loc":{"start":{"line":292,"column":41},"end":{"line":294,"column":7}},"line":292},"22":{"name":"compositeState","decl":{"start":{"line":299,"column":27},"end":{"line":299,"column":41}},"loc":{"start":{"line":299,"column":50},"end":{"line":309,"column":3}},"line":299}},"branchMap":{"0":{"loc":{"start":{"line":3,"column":51},"end":{"line":3,"column":355}},"type":"if","locations":[{"start":{"line":3,"column":51},"end":{"line":3,"column":355}},{"start":{"line":3,"column":51},"end":{"line":3,"column":355}}],"line":3},"1":{"loc":{"start":{"line":3,"column":55},"end":{"line":3,"column":122}},"type":"binary-expr","locations":[{"start":{"line":3,"column":55},"end":{"line":3,"column":83}},{"start":{"line":3,"column":87},"end":{"line":3,"column":122}}],"line":3},"2":{"loc":{"start":{"line":3,"column":232},"end":{"line":3,"column":349}},"type":"cond-expr","locations":[{"start":{"line":3,"column":328},"end":{"line":3,"column":336}},{"start":{"line":3,"column":339},"end":{"line":3,"column":349}}],"line":3},"3":{"loc":{"start":{"line":3,"column":232},"end":{"line":3,"column":325}},"type":"binary-expr","locations":[{"start":{"line":3,"column":232},"end":{"line":3,"column":235}},{"start":{"line":3,"column":239},"end":{"line":3,"column":267}},{"start":{"line":3,"column":271},"end":{"line":3,"column":297}},{"start":{"line":3,"column":301},"end":{"line":3,"column":325}}],"line":3},"4":{"loc":{"start":{"line":32,"column":4},"end":{"line":34,"column":5}},"type":"if","locations":[{"start":{"line":32,"column":4},"end":{"line":34,"column":5}},{"start":{"line":32,"column":4},"end":{"line":34,"column":5}}],"line":32},"5":{"loc":{"start":{"line":36,"column":4},"end":{"line":38,"column":5}},"type":"if","locations":[{"start":{"line":36,"column":4},"end":{"line":38,"column":5}},{"start":{"line":36,"column":4},"end":{"line":38,"column":5}}],"line":36},"6":{"loc":{"start":{"line":49,"column":6},"end":{"line":51,"column":7}},"type":"if","locations":[{"start":{"line":49,"column":6},"end":{"line":51,"column":7}},{"start":{"line":49,"column":6},"end":{"line":51,"column":7}}],"line":49},"7":{"loc":{"start":{"line":49,"column":10},"end":{"line":49,"column":66}},"type":"binary-expr","locations":[{"start":{"line":49,"column":10},"end":{"line":49,"column":23}},{"start":{"line":49,"column":27},"end":{"line":49,"column":66}}],"line":49},"8":{"loc":{"start":{"line":54,"column":4},"end":{"line":58,"column":5}},"type":"if","locations":[{"start":{"line":54,"column":4},"end":{"line":58,"column":5}},{"start":{"line":54,"column":4},"end":{"line":58,"column":5}}],"line":54},"9":{"loc":{"start":{"line":56,"column":14},"end":{"line":56,"column":63}},"type":"binary-expr","locations":[{"start":{"line":56,"column":14},"end":{"line":56,"column":32}},{"start":{"line":56,"column":36},"end":{"line":56,"column":63}}],"line":56},"10":{"loc":{"start":{"line":63,"column":4},"end":{"line":65,"column":5}},"type":"if","locations":[{"start":{"line":63,"column":4},"end":{"line":65,"column":5}},{"start":{"line":63,"column":4},"end":{"line":65,"column":5}}],"line":63},"11":{"loc":{"start":{"line":67,"column":27},"end":{"line":67,"column":53}},"type":"binary-expr","locations":[{"start":{"line":67,"column":27},"end":{"line":67,"column":47}},{"start":{"line":67,"column":51},"end":{"line":67,"column":53}}],"line":67},"12":{"loc":{"start":{"line":69,"column":4},"end":{"line":72,"column":5}},"type":"if","locations":[{"start":{"line":69,"column":4},"end":{"line":72,"column":5}},{"start":{"line":69,"column":4},"end":{"line":72,"column":5}}],"line":69},"13":{"loc":{"start":{"line":77,"column":4},"end":{"line":82,"column":5}},"type":"if","locations":[{"start":{"line":77,"column":4},"end":{"line":82,"column":5}},{"start":{"line":77,"column":4},"end":{"line":82,"column":5}}],"line":77},"14":{"loc":{"start":{"line":86,"column":12},"end":{"line":86,"column":24}},"type":"binary-expr","locations":[{"start":{"line":86,"column":12},"end":{"line":86,"column":16}},{"start":{"line":86,"column":20},"end":{"line":86,"column":24}}],"line":86},"15":{"loc":{"start":{"line":98,"column":4},"end":{"line":100,"column":5}},"type":"if","locations":[{"start":{"line":98,"column":4},"end":{"line":100,"column":5}},{"start":{"line":98,"column":4},"end":{"line":100,"column":5}}],"line":98},"16":{"loc":{"start":{"line":102,"column":11},"end":{"line":102,"column":65}},"type":"cond-expr","locations":[{"start":{"line":102,"column":24},"end":{"line":102,"column":29}},{"start":{"line":102,"column":32},"end":{"line":102,"column":65}}],"line":102},"17":{"loc":{"start":{"line":111,"column":4},"end":{"line":113,"column":5}},"type":"if","locations":[{"start":{"line":111,"column":4},"end":{"line":113,"column":5}},{"start":{"line":111,"column":4},"end":{"line":113,"column":5}}],"line":111},"18":{"loc":{"start":{"line":115,"column":4},"end":{"line":121,"column":5}},"type":"if","locations":[{"start":{"line":115,"column":4},"end":{"line":121,"column":5}},{"start":{"line":115,"column":4},"end":{"line":121,"column":5}}],"line":115},"19":{"loc":{"start":{"line":126,"column":4},"end":{"line":128,"column":5}},"type":"if","locations":[{"start":{"line":126,"column":4},"end":{"line":128,"column":5}},{"start":{"line":126,"column":4},"end":{"line":128,"column":5}}],"line":126},"20":{"loc":{"start":{"line":136,"column":4},"end":{"line":185,"column":5}},"type":"if","locations":[{"start":{"line":136,"column":4},"end":{"line":185,"column":5}},{"start":{"line":136,"column":4},"end":{"line":185,"column":5}}],"line":136},"21":{"loc":{"start":{"line":139,"column":6},"end":{"line":184,"column":7}},"type":"if","locations":[{"start":{"line":139,"column":6},"end":{"line":184,"column":7}},{"start":{"line":139,"column":6},"end":{"line":184,"column":7}}],"line":139},"22":{"loc":{"start":{"line":139,"column":10},"end":{"line":139,"column":82}},"type":"binary-expr","locations":[{"start":{"line":139,"column":10},"end":{"line":139,"column":15}},{"start":{"line":139,"column":19},"end":{"line":139,"column":60}},{"start":{"line":139,"column":64},"end":{"line":139,"column":82}}],"line":139},"23":{"loc":{"start":{"line":140,"column":26},"end":{"line":140,"column":63}},"type":"binary-expr","locations":[{"start":{"line":140,"column":26},"end":{"line":140,"column":41}},{"start":{"line":140,"column":45},"end":{"line":140,"column":63}}],"line":140},"24":{"loc":{"start":{"line":149,"column":8},"end":{"line":151,"column":9}},"type":"if","locations":[{"start":{"line":149,"column":8},"end":{"line":151,"column":9}},{"start":{"line":149,"column":8},"end":{"line":151,"column":9}}],"line":149},"25":{"loc":{"start":{"line":149,"column":12},"end":{"line":149,"column":71}},"type":"binary-expr","locations":[{"start":{"line":149,"column":12},"end":{"line":149,"column":27}},{"start":{"line":149,"column":31},"end":{"line":149,"column":71}}],"line":149},"26":{"loc":{"start":{"line":153,"column":22},"end":{"line":153,"column":77}},"type":"cond-expr","locations":[{"start":{"line":153,"column":53},"end":{"line":153,"column":71}},{"start":{"line":153,"column":74},"end":{"line":153,"column":77}}],"line":153},"27":{"loc":{"start":{"line":155,"column":18},"end":{"line":155,"column":73}},"type":"binary-expr","locations":[{"start":{"line":155,"column":18},"end":{"line":155,"column":39}},{"start":{"line":155,"column":43},"end":{"line":155,"column":60}},{"start":{"line":155,"column":64},"end":{"line":155,"column":73}}],"line":155},"28":{"loc":{"start":{"line":164,"column":8},"end":{"line":179,"column":9}},"type":"if","locations":[{"start":{"line":164,"column":8},"end":{"line":179,"column":9}},{"start":{"line":164,"column":8},"end":{"line":179,"column":9}}],"line":164},"29":{"loc":{"start":{"line":171,"column":10},"end":{"line":176,"column":11}},"type":"if","locations":[{"start":{"line":171,"column":10},"end":{"line":176,"column":11}},{"start":{"line":171,"column":10},"end":{"line":176,"column":11}}],"line":171},"30":{"loc":{"start":{"line":198,"column":4},"end":{"line":241,"column":5}},"type":"if","locations":[{"start":{"line":198,"column":4},"end":{"line":241,"column":5}},{"start":{"line":198,"column":4},"end":{"line":241,"column":5}}],"line":198},"31":{"loc":{"start":{"line":198,"column":8},"end":{"line":198,"column":58}},"type":"binary-expr","locations":[{"start":{"line":198,"column":8},"end":{"line":198,"column":33}},{"start":{"line":198,"column":37},"end":{"line":198,"column":58}}],"line":198},"32":{"loc":{"start":{"line":199,"column":6},"end":{"line":235,"column":7}},"type":"if","locations":[{"start":{"line":199,"column":6},"end":{"line":235,"column":7}},{"start":{"line":199,"column":6},"end":{"line":235,"column":7}}],"line":199},"33":{"loc":{"start":{"line":202,"column":8},"end":{"line":208,"column":9}},"type":"if","locations":[{"start":{"line":202,"column":8},"end":{"line":208,"column":9}},{"start":{"line":202,"column":8},"end":{"line":208,"column":9}}],"line":202},"34":{"loc":{"start":{"line":202,"column":12},"end":{"line":202,"column":46}},"type":"binary-expr","locations":[{"start":{"line":202,"column":12},"end":{"line":202,"column":23}},{"start":{"line":202,"column":27},"end":{"line":202,"column":46}}],"line":202},"35":{"loc":{"start":{"line":220,"column":8},"end":{"line":222,"column":9}},"type":"if","locations":[{"start":{"line":220,"column":8},"end":{"line":222,"column":9}},{"start":{"line":220,"column":8},"end":{"line":222,"column":9}}],"line":220},"36":{"loc":{"start":{"line":226,"column":8},"end":{"line":228,"column":9}},"type":"if","locations":[{"start":{"line":226,"column":8},"end":{"line":228,"column":9}},{"start":{"line":226,"column":8},"end":{"line":228,"column":9}}],"line":226},"37":{"loc":{"start":{"line":230,"column":8},"end":{"line":232,"column":9}},"type":"if","locations":[{"start":{"line":230,"column":8},"end":{"line":232,"column":9}},{"start":{"line":230,"column":8},"end":{"line":232,"column":9}}],"line":230},"38":{"loc":{"start":{"line":245,"column":20},"end":{"line":245,"column":90}},"type":"cond-expr","locations":[{"start":{"line":245,"column":43},"end":{"line":245,"column":52}},{"start":{"line":245,"column":55},"end":{"line":245,"column":90}}],"line":245},"39":{"loc":{"start":{"line":245,"column":55},"end":{"line":245,"column":90}},"type":"cond-expr","locations":[{"start":{"line":245,"column":67},"end":{"line":245,"column":78}},{"start":{"line":245,"column":81},"end":{"line":245,"column":90}}],"line":245},"40":{"loc":{"start":{"line":247,"column":4},"end":{"line":259,"column":5}},"type":"if","locations":[{"start":{"line":247,"column":4},"end":{"line":259,"column":5}},{"start":{"line":247,"column":4},"end":{"line":259,"column":5}}],"line":247},"41":{"loc":{"start":{"line":269,"column":13},"end":{"line":269,"column":78}},"type":"binary-expr","locations":[{"start":{"line":269,"column":13},"end":{"line":269,"column":29}},{"start":{"line":269,"column":33},"end":{"line":269,"column":78}}],"line":269},"42":{"loc":{"start":{"line":283,"column":4},"end":{"line":297,"column":5}},"type":"if","locations":[{"start":{"line":283,"column":4},"end":{"line":297,"column":5}},{"start":{"line":283,"column":4},"end":{"line":297,"column":5}}],"line":283},"43":{"loc":{"start":{"line":302,"column":16},"end":{"line":302,"column":79}},"type":"binary-expr","locations":[{"start":{"line":302,"column":16},"end":{"line":302,"column":41}},{"start":{"line":302,"column":45},"end":{"line":302,"column":79}}],"line":302},"44":{"loc":{"start":{"line":304,"column":4},"end":{"line":306,"column":5}},"type":"if","locations":[{"start":{"line":304,"column":4},"end":{"line":306,"column":5}},{"start":{"line":304,"column":4},"end":{"line":306,"column":5}}],"line":304}},"s":{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0,"88":0,"89":0,"90":0,"91":0,"92":0,"93":0,"94":0,"95":0,"96":0,"97":0,"98":0,"99":0,"100":0,"101":0,"102":0,"103":0,"104":0,"105":0,"106":0,"107":0,"108":0,"109":0,"110":0,"111":0,"112":0,"113":0,"114":0,"115":0,"116":0,"117":0,"118":0,"119":0,"120":0,"121":0,"122":0,"123":0,"124":0,"125":0,"126":0,"127":0,"128":0,"129":0,"130":0,"131":0,"132":0,"133":0,"134":0,"135":0,"136":0,"137":0,"138":0,"139":0,"140":0,"141":0,"142":0,"143":0,"144":0,"145":0},"f":{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0},"b":{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0,0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0,0],"23":[0,0],"24":[0,0],"25":[0,0],"26":[0,0],"27":[0,0,0],"28":[0,0],"29":[0,0],"30":[0,0],"31":[0,0],"32":[0,0],"33":[0,0],"34":[0,0],"35":[0,0],"36":[0,0],"37":[0,0],"38":[0,0],"39":[0,0],"40":[0,0],"41":[0,0],"42":[0,0],"43":[0,0],"44":[0,0]},"inputSourceMap":{"version":3,"sources":["BehavioralFsm.js"],"names":["_","require","utils","emitter","topLevelEmitter","instance","events","MACHINA_PROP","BehavioralFsm","options","extend","defaults","getDefaultBehavioralOptions","initialize","apply","arguments","emit","NEW_FSM","prototype","initClient","client","initialState","Error","states","transition","configForState","newState","newStateObj","child","each","hierarchy","childListener","off","_child","getChildFsmInstance","namespace","listenToChild","ensureClientMeta","cloneDeep","getDefaultClientMeta","buildEventPayload","data","isPlainObject","getHandlerArgs","args","isCatchAll","_args","slice","input","splice","inputType","concat","getSystemHandlerArgs","handle","inputDef","delegated","ticket","undefined","clientMeta","getLeaklessArgs","currentActionArgs","currentState","state","stateObj","handlerName","handler","result","action","inExitHandler","pendingDelegations","bubbling","createUUID","delegatedTo","currentAction","eventPayload","NO_HANDLER","HANDLING","HANDLED","priorAction","curState","curStateObj","_onExit","call","targetReplayState","priorState","fromState","toState","TRANSITION","_onEnter","TRANSITIONED","processQueue","NEXT_TRANSITION","INVALID_STATE","attemptedState","deferUntilTransition","stateName","stateList","isArray","queued","type","untilState","inputQueue","push","queuedArgs","DEFERRED","deferAndTransition","filterFn","item","includes","toProcess","filter","difference","bind","clearQueue","name","without","evnt","length","compositeState","getInstance","module","exports"],"mappings":"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","sourceRoot":"/Users/jim/git/oss/machina/src/","sourcesContent":["const _ = require( \"lodash\" );\nconst utils = require( \"./utils\" );\nconst emitter = require( \"./emitter\" );\nconst topLevelEmitter = emitter.instance;\nconst events = require( \"./events\" );\n\nconst MACHINA_PROP = \"__machina__\";\n\nfunction BehavioralFsm( options ) {\n\t_.extend( this, options );\n\t_.defaults( this, utils.getDefaultBehavioralOptions() );\n\tthis.initialize.apply( this, arguments ); // eslint-disable-line prefer-spread, prefer-rest-params\n\ttopLevelEmitter.emit( events.NEW_FSM, this );\n}\n\n_.extend( BehavioralFsm.prototype, {\n\tinitialize() {},\n\n\tinitClient: function initClient( client ) {\n\t\tconst initialState = this.initialState;\n\t\tif ( !initialState ) {\n\t\t\tthrow new Error( \"You must specify an initial state for this FSM\" );\n\t\t}\n\t\tif ( !this.states[ initialState ] ) {\n\t\t\tthrow new Error( \"The initial state specified does not exist in the states object.\" );\n\t\t}\n\t\tthis.transition( client, initialState );\n\t},\n\n\tconfigForState: function configForState( newState ) {\n\t\tconst newStateObj = this.states[ newState ];\n\t\tlet child;\n\t\t_.each( this.hierarchy, function( childListener /* key */ ) {\n\t\t\tif ( childListener && typeof childListener.off === \"function\" ) {\n\t\t\t\tchildListener.off();\n\t\t\t}\n\t\t} );\n\n\t\tif ( newStateObj._child ) {\n\t\t\tnewStateObj._child = utils.getChildFsmInstance( newStateObj._child );\n\t\t\tchild = newStateObj._child && newStateObj._child.instance;\n\t\t\tthis.hierarchy[ child.namespace ] = utils.listenToChild( this, child );\n\t\t}\n\n\t\treturn child;\n\t},\n\n\tensureClientMeta: function ensureClientMeta( client ) {\n\t\tif ( typeof client !== \"object\" ) {\n\t\t\tthrow new Error( \"An FSM client must be an object.\" );\n\t\t}\n\t\tclient[ MACHINA_PROP ] = client[ MACHINA_PROP ] || {};\n\t\tif ( !client[ MACHINA_PROP ][ this.namespace ] ) {\n\t\t\tclient[ MACHINA_PROP ][ this.namespace ] = _.cloneDeep( utils.getDefaultClientMeta() );\n\t\t\tthis.initClient( client );\n\t\t}\n\t\treturn client[ MACHINA_PROP ][ this.namespace ];\n\t},\n\n\tbuildEventPayload( client, data ) {\n\t\tif ( _.isPlainObject( data ) ) {\n\t\t\treturn _.extend( data, { client, namespace: this.namespace, } );\n\t\t}\n\t\treturn { client, data: data || null, namespace: this.namespace, };\n\t},\n\n\tgetHandlerArgs( args, isCatchAll ) {\n\t\t// index 0 is the client, index 1 is inputType\n\t\t// if we're in a catch-all handler, input type needs to be included in the args\n\t\t// inputType might be an object, so we need to just get the inputType string if so\n\t\tconst _args = args.slice( 0 );\n\t\tconst input = _args[ 1 ];\n\t\tif ( typeof input === \"object\" ) {\n\t\t\t_args.splice( 1, 1, input.inputType );\n\t\t}\n\t\treturn isCatchAll ?\n\t\t\t_args :\n\t\t\t[ _args[ 0 ], ].concat( _args.slice( 2 ) );\n\t},\n\n\tgetSystemHandlerArgs( args, client ) {\n\t\treturn [ client, ].concat( args );\n\t},\n\n\t// eslint-disable-next-line max-statements\n\thandle( client, input ) {\n\t\tlet inputDef = input;\n\t\tif ( typeof input === \"undefined\" ) {\n\t\t\tthrow new Error( \"The input argument passed to the FSM's handle method is undefined. Did you forget to pass the input name?\" );\n\t\t}\n\t\tif ( typeof input === \"string\" ) {\n\t\t\tinputDef = { inputType: input, delegated: false, ticket: undefined, };\n\t\t}\n\t\tconst clientMeta = this.ensureClientMeta( client );\n\t\tconst args = utils.getLeaklessArgs( arguments ); // eslint-disable-line prefer-rest-params\n\t\tif ( typeof input !== \"object\" ) {\n\t\t\targs.splice( 1, 1, inputDef );\n\t\t}\n\t\tclientMeta.currentActionArgs = args.slice( 1 );\n\t\tconst currentState = clientMeta.state;\n\t\tconst stateObj = this.states[ currentState ];\n\t\tlet handlerName,\n\t\t\thandler,\n\t\t\tchild,\n\t\t\tresult,\n\t\t\taction;\n\t\tlet isCatchAll = false;\n\t\tif ( !clientMeta.inExitHandler ) {\n\t\t\tchild = this.configForState( currentState );\n\t\t\tif ( child && !this.pendingDelegations[ inputDef.ticket ] && !inputDef.bubbling ) {\n\t\t\t\tinputDef.ticket = ( inputDef.ticket || utils.createUUID() );\n\t\t\t\tinputDef.delegated = true;\n\t\t\t\tthis.pendingDelegations[ inputDef.ticket ] = { delegatedTo: child.namespace, };\n\t\t\t\t// WARNING - returning a value from `handle` on child FSMs is not really supported.\n\t\t\t\t// If you need to return values from child FSM input handlers, use events instead.\n\t\t\t\tresult = child.handle.apply( child, args ); // eslint-disable-line prefer-spread\n\t\t\t} else {\n\t\t\t\tif ( inputDef.ticket && this.pendingDelegations[ inputDef.ticket ] ) {\n\t\t\t\t\tdelete this.pendingDelegations[ inputDef.ticket ];\n\t\t\t\t}\n\t\t\t\thandlerName = stateObj[ inputDef.inputType ] ? inputDef.inputType : \"*\";\n\t\t\t\tisCatchAll = ( handlerName === \"*\" );\n\t\t\t\thandler = ( stateObj[ handlerName ] || this[ handlerName ] ) || this[ \"*\" ];\n\t\t\t\taction = `${ clientMeta.state }.${ handlerName }`;\n\t\t\t\tclientMeta.currentAction = action;\n\t\t\t\tconst eventPayload = this.buildEventPayload(\n\t\t\t\t\tclient,\n\t\t\t\t\t{ inputType: inputDef.inputType, delegated: inputDef.delegated, ticket: inputDef.ticket, }\n\t\t\t\t);\n\t\t\t\tif ( !handler ) {\n\t\t\t\t\tthis.emit( events.NO_HANDLER, _.extend( { args, }, eventPayload ) );\n\t\t\t\t} else {\n\t\t\t\t\tthis.emit( events.HANDLING, eventPayload );\n\t\t\t\t\tif ( typeof handler === \"function\" ) {\n\t\t\t\t\t\tresult = handler.apply( this, this.getHandlerArgs( args, isCatchAll ) );\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult = handler;\n\t\t\t\t\t\tthis.transition( client, handler );\n\t\t\t\t\t}\n\t\t\t\t\tthis.emit( events.HANDLED, eventPayload );\n\t\t\t\t}\n\t\t\t\tclientMeta.priorAction = clientMeta.currentAction;\n\t\t\t\tclientMeta.currentAction = \"\";\n\t\t\t\tclientMeta.currentActionArgs = undefined;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t},\n\n\t// eslint-disable-next-line max-statements\n\ttransition( client, newState ) {\n\t\tconst clientMeta = this.ensureClientMeta( client );\n\t\tconst curState = clientMeta.state;\n\t\tconst curStateObj = this.states[ curState ];\n\t\tconst newStateObj = this.states[ newState ];\n\t\tlet child;\n\t\tconst args = utils.getLeaklessArgs( arguments ).slice( 2 ); // eslint-disable-line prefer-rest-params\n\t\tif ( !clientMeta.inExitHandler && newState !== curState ) {\n\t\t\tif ( newStateObj ) {\n\t\t\t\tchild = this.configForState( newState );\n\t\t\t\tif ( curStateObj && curStateObj._onExit ) {\n\t\t\t\t\tclientMeta.inExitHandler = true;\n\t\t\t\t\tcurStateObj._onExit.call( this, client );\n\t\t\t\t\tclientMeta.inExitHandler = false;\n\t\t\t\t}\n\t\t\t\tclientMeta.targetReplayState = newState;\n\t\t\t\tclientMeta.priorState = curState;\n\t\t\t\tclientMeta.state = newState;\n\t\t\t\tconst eventPayload = this.buildEventPayload( client, {\n\t\t\t\t\tfromState: clientMeta.priorState,\n\t\t\t\t\taction: clientMeta.currentAction,\n\t\t\t\t\ttoState: newState,\n\t\t\t\t} );\n\t\t\t\tthis.emit( events.TRANSITION, eventPayload );\n\t\t\t\tif ( newStateObj._onEnter ) {\n\t\t\t\t\tnewStateObj._onEnter.apply( this, this.getSystemHandlerArgs( args, client ) );\n\t\t\t\t}\n\t\t\t\tthis.emit( events.TRANSITIONED, eventPayload );\n\t\t\t\tif ( child ) {\n\t\t\t\t\tchild.handle( client, \"_reset\" );\n\t\t\t\t}\n\n\t\t\t\tif ( clientMeta.targetReplayState === newState ) {\n\t\t\t\t\tthis.processQueue( client, events.NEXT_TRANSITION );\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.emit( events.INVALID_STATE, this.buildEventPayload( client, {\n\t\t\t\tstate: clientMeta.state,\n\t\t\t\tattemptedState: newState,\n\t\t\t} ) );\n\t\t}\n\t},\n\n\tdeferUntilTransition( client, stateName ) {\n\t\tconst clientMeta = this.ensureClientMeta( client );\n\t\tconst stateList = _.isArray( stateName ) ? stateName : ( stateName ? [ stateName, ] : undefined ); // eslint-disable-line no-nested-ternary\n\t\tif ( clientMeta.currentActionArgs ) {\n\t\t\tconst queued = {\n\t\t\t\ttype: events.NEXT_TRANSITION,\n\t\t\t\tuntilState: stateList,\n\t\t\t\targs: clientMeta.currentActionArgs,\n\t\t\t};\n\t\t\tclientMeta.inputQueue.push( queued );\n\t\t\tconst eventPayload = this.buildEventPayload( client, {\n\t\t\t\tstate: clientMeta.state,\n\t\t\t\tqueuedArgs: queued,\n\t\t\t} );\n\t\t\tthis.emit( events.DEFERRED, eventPayload );\n\t\t}\n\t},\n\n\tdeferAndTransition( client, stateName ) {\n\t\tthis.deferUntilTransition( client, stateName );\n\t\tthis.transition( client, stateName );\n\t},\n\n\tprocessQueue( client ) {\n\t\tconst clientMeta = this.ensureClientMeta( client );\n\t\tconst filterFn = function( item ) {\n\t\t\treturn ( ( !item.untilState ) || ( _.includes( item.untilState, clientMeta.state ) ) );\n\t\t};\n\t\tconst toProcess = _.filter( clientMeta.inputQueue, filterFn );\n\t\tclientMeta.inputQueue = _.difference( clientMeta.inputQueue, toProcess );\n\t\t_.each( toProcess, function( item ) {\n\t\t\tthis.handle.apply( this, [ client, ].concat( item.args ) ); // eslint-disable-line prefer-spread\n\t\t}.bind( this ) );\n\t},\n\n\tclearQueue( client, name ) {\n\t\tconst clientMeta = this.ensureClientMeta( client );\n\t\tif ( !name ) {\n\t\t\tclientMeta.inputQueue = [];\n\t\t} else {\n\t\t\t// first pass we remove the target state from any `untilState` array\n\t\t\t_.each( clientMeta.inputQueue, function( item ) {\n\t\t\t\titem.untilState = _.without( item.untilState, name );\n\t\t\t} );\n\t\t\t// second pass we clear out deferred events with empty untilState arrays\n\t\t\tconst filter = function( evnt ) {\n\t\t\t\treturn evnt.untilState.length !== 0;\n\t\t\t};\n\t\t\tclientMeta.inputQueue = _.filter( clientMeta.inputQueue, filter );\n\t\t}\n\t},\n\n\tcompositeState( client ) {\n\t\tconst clientMeta = this.ensureClientMeta( client );\n\t\tlet state = clientMeta.state;\n\t\tconst child = this.states[ state ]._child && this.states[ state ]._child.instance;\n\t\tif ( child ) {\n\t\t\tstate += `.${ child.compositeState( client ) }`;\n\t\t}\n\t\treturn state;\n\t},\n}, emitter.getInstance() );\n\nBehavioralFsm.extend = utils.extend;\n\nmodule.exports = BehavioralFsm;\n"]},"all":true},"/Users/jim/git/oss/machina/src/emitter.js":{"path":"/Users/jim/git/oss/machina/src/emitter.js","statementMap":{"0":{"start":{"line":3,"column":12},"end":{"line":3,"column":30}},"1":{"start":{"line":5,"column":8},"end":{"line":5,"column":25}},"2":{"start":{"line":8,"column":2},"end":{"line":80,"column":4}},"3":{"start":{"line":10,"column":17},"end":{"line":10,"column":49}},"4":{"start":{"line":12,"column":6},"end":{"line":28,"column":7}},"5":{"start":{"line":13,"column":8},"end":{"line":27,"column":22}},"6":{"start":{"line":14,"column":10},"end":{"line":26,"column":11}},"7":{"start":{"line":15,"column":12},"end":{"line":15,"column":39}},"8":{"start":{"line":17,"column":12},"end":{"line":25,"column":13}},"9":{"start":{"line":18,"column":14},"end":{"line":18,"column":41}},"10":{"start":{"line":21,"column":14},"end":{"line":24,"column":15}},"11":{"start":{"line":23,"column":16},"end":{"line":23,"column":45}},"12":{"start":{"line":30,"column":6},"end":{"line":46,"column":7}},"13":{"start":{"line":31,"column":8},"end":{"line":45,"column":22}},"14":{"start":{"line":32,"column":10},"end":{"line":44,"column":11}},"15":{"start":{"line":33,"column":12},"end":{"line":33,"column":48}},"16":{"start":{"line":35,"column":12},"end":{"line":43,"column":13}},"17":{"start":{"line":36,"column":14},"end":{"line":36,"column":50}},"18":{"start":{"line":39,"column":14},"end":{"line":42,"column":15}},"19":{"start":{"line":41,"column":16},"end":{"line":41,"column":45}},"20":{"start":{"line":49,"column":17},"end":{"line":49,"column":21}},"21":{"start":{"line":50,"column":6},"end":{"line":52,"column":8}},"22":{"start":{"line":54,"column":6},"end":{"line":56,"column":7}},"23":{"start":{"line":55,"column":8},"end":{"line":55,"column":44}},"24":{"start":{"line":58,"column":6},"end":{"line":58,"column":52}},"25":{"start":{"line":59,"column":6},"end":{"line":65,"column":8}},"26":{"start":{"line":63,"column":10},"end":{"line":63,"column":40}},"27":{"start":{"line":68,"column":6},"end":{"line":70,"column":8}},"28":{"start":{"line":72,"column":6},"end":{"line":78,"column":7}},"29":{"start":{"line":73,"column":8},"end":{"line":73,"column":33}},"30":{"start":{"line":74,"column":13},"end":{"line":78,"column":7}},"31":{"start":{"line":75,"column":8},"end":{"line":75,"column":93}},"32":{"start":{"line":77,"column":8},"end":{"line":77,"column":44}},"33":{"start":{"line":83,"column":0},"end":{"line":86,"column":2}}},"fnMap":{"0":{"name":"getInstance","decl":{"start":{"line":7,"column":9},"end":{"line":7,"column":20}},"loc":{"start":{"line":7,"column":23},"end":{"line":81,"column":1}},"line":7},"1":{"name":"emit","decl":{"start":{"line":9,"column":19},"end":{"line":9,"column":23}},"loc":{"start":{"line":9,"column":35},"end":{"line":47,"column":5}},"line":9},"2":{"name":"(anonymous_2)","decl":{"start":{"line":13,"column":41},"end":{"line":13,"column":42}},"loc":{"start":{"line":13,"column":61},"end":{"line":27,"column":9}},"line":13},"3":{"name":"(anonymous_3)","decl":{"start":{"line":31,"column":47},"end":{"line":31,"column":48}},"loc":{"start":{"line":31,"column":67},"end":{"line":45,"column":9}},"line":31},"4":{"name":"on","decl":{"start":{"line":48,"column":17},"end":{"line":48,"column":19}},"loc":{"start":{"line":48,"column":41},"end":{"line":66,"column":5}},"line":48},"5":{"name":"off","decl":{"start":{"line":62,"column":22},"end":{"line":62,"column":25}},"loc":{"start":{"line":62,"column":28},"end":{"line":64,"column":9}},"line":62},"6":{"name":"off","decl":{"start":{"line":67,"column":18},"end":{"line":67,"column":21}},"loc":{"start":{"line":67,"column":43},"end":{"line":79,"column":5}},"line":67}},"branchMap":{"0":{"loc":{"start":{"line":12,"column":6},"end":{"line":28,"column":7}},"type":"if","locations":[{"start":{"line":12,"column":6},"end":{"line":28,"column":7}},{"start":{"line":12,"column":6},"end":{"line":28,"column":7}}],"line":12},"1":{"loc":{"start":{"line":14,"column":10},"end":{"line":26,"column":11}},"type":"if","locations":[{"start":{"line":14,"column":10},"end":{"line":26,"column":11}},{"start":{"line":14,"column":10},"end":{"line":26,"column":11}}],"line":14},"2":{"loc":{"start":{"line":21,"column":14},"end":{"line":24,"column":15}},"type":"if","locations":[{"start":{"line":21,"column":14},"end":{"line":24,"column":15}}],"line":21},"3":{"loc":{"start":{"line":21,"column":18},"end":{"line":21,"column":63}},"type":"binary-expr","locations":[{"start":{"line":21,"column":18},"end":{"line":21,"column":25}},{"start":{"line":21,"column":29},"end":{"line":21,"column":63}}],"line":21},"4":{"loc":{"start":{"line":30,"column":6},"end":{"line":46,"column":7}},"type":"if","locations":[{"start":{"line":30,"column":6},"end":{"line":46,"column":7}},{"start":{"line":30,"column":6},"end":{"line":46,"column":7}}],"line":30},"5":{"loc":{"start":{"line":32,"column":10},"end":{"line":44,"column":11}},"type":"if","locations":[{"start":{"line":32,"column":10},"end":{"line":44,"column":11}},{"start":{"line":32,"column":10},"end":{"line":44,"column":11}}],"line":32},"6":{"loc":{"start":{"line":39,"column":14},"end":{"line":42,"column":15}},"type":"if","locations":[{"start":{"line":39,"column":14},"end":{"line":42,"column":15}}],"line":39},"7":{"loc":{"start":{"line":39,"column":18},"end":{"line":39,"column":63}},"type":"binary-expr","locations":[{"start":{"line":39,"column":18},"end":{"line":39,"column":25}},{"start":{"line":39,"column":29},"end":{"line":39,"column":63}}],"line":39},"8":{"loc":{"start":{"line":50,"column":28},"end":{"line":52,"column":7}},"type":"binary-expr","locations":[{"start":{"line":50,"column":28},"end":{"line":50,"column":47}},{"start":{"line":50,"column":51},"end":{"line":52,"column":7}}],"line":50},"9":{"loc":{"start":{"line":54,"column":6},"end":{"line":56,"column":7}},"type":"if","locations":[{"start":{"line":54,"column":6},"end":{"line":56,"column":7}},{"start":{"line":54,"column":6},"end":{"line":56,"column":7}}],"line":54},"10":{"loc":{"start":{"line":68,"column":28},"end":{"line":70,"column":7}},"type":"binary-expr","locations":[{"start":{"line":68,"column":28},"end":{"line":68,"column":47}},{"start":{"line":68,"column":51},"end":{"line":70,"column":7}}],"line":68},"11":{"loc":{"start":{"line":72,"column":6},"end":{"line":78,"column":7}},"type":"if","locations":[{"start":{"line":72,"column":6},"end":{"line":78,"column":7}},{"start":{"line":72,"column":6},"end":{"line":78,"column":7}}],"line":72},"12":{"loc":{"start":{"line":74,"column":13},"end":{"line":78,"column":7}},"type":"if","locations":[{"start":{"line":74,"column":13},"end":{"line":78,"column":7}},{"start":{"line":74,"column":13},"end":{"line":78,"column":7}}],"line":74}},"s":{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0},"f":{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},"b":{"0":[0,0],"1":[0,0],"2":[0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0]},"inputSourceMap":{"version":3,"sources":["emitter.js"],"names":["utils","require","_","getInstance","emit","eventName","args","getLeaklessArgs","arguments","eventListeners","each","callback","useSafeEmit","apply","exception","console","log","stack","bind","slice","on","self","push","off","without","module","exports","instance"],"mappings":";;AAAA,IAAMA,KAAK,GAAGC,OAAO,CAAE,SAAF,CAArB;;AACA,IAAMC,CAAC,GAAGD,OAAO,CAAE,QAAF,CAAjB;;AAEA,SAASE,WAAT,GAAuB;AACtB,SAAO;AACNC,IAAAA,IADM,gBACAC,SADA,EACY;AACjB,UAAMC,IAAI,GAAGN,KAAK,CAACO,eAAN,CAAuBC,SAAvB,CAAb,CADiB,CACgC;;AACjD,UAAK,KAAKC,cAAL,CAAqB,GAArB,CAAL,EAAkC;AACjCP,QAAAA,CAAC,CAACQ,IAAF,CAAQ,KAAKD,cAAL,CAAqB,GAArB,CAAR,EAAoC,UAAUE,QAAV,EAAqB;AACxD,cAAK,CAAC,KAAKC,WAAX,EAAyB;AACxBD,YAAAA,QAAQ,CAACE,KAAT,CAAgB,IAAhB,EAAsBP,IAAtB;AACA,WAFD,MAEO;AACN,gBAAI;AACHK,cAAAA,QAAQ,CAACE,KAAT,CAAgB,IAAhB,EAAsBP,IAAtB;AACA,aAFD,CAEE,OAAQQ,SAAR,EAAoB;AACrB;AACA,kBAAKC,OAAO,IAAI,OAAOA,OAAO,CAACC,GAAf,KAAuB,WAAvC,EAAqD;AAAE;AACtDD,gBAAAA,OAAO,CAACC,GAAR,CAAaF,SAAS,CAACG,KAAvB,EADoD,CACpB;AAChC;AACD;AACD;AACD,SAbmC,CAalCC,IAbkC,CAa5B,IAb4B,CAApC;AAcA;;AACD,UAAK,KAAKT,cAAL,CAAqBJ,SAArB,CAAL,EAAwC;AACvCH,QAAAA,CAAC,CAACQ,IAAF,CAAQ,KAAKD,cAAL,CAAqBJ,SAArB,CAAR,EAA0C,UAAUM,QAAV,EAAqB;AAC9D,cAAK,CAAC,KAAKC,WAAX,EAAyB;AACxBD,YAAAA,QAAQ,CAACE,KAAT,CAAgB,IAAhB,EAAsBP,IAAI,CAACa,KAAL,CAAY,CAAZ,CAAtB;AACA,WAFD,MAEO;AACN,gBAAI;AACHR,cAAAA,QAAQ,CAACE,KAAT,CAAgB,IAAhB,EAAsBP,IAAI,CAACa,KAAL,CAAY,CAAZ,CAAtB;AACA,aAFD,CAEE,OAAQL,SAAR,EAAoB;AACrB;AACA,kBAAKC,OAAO,IAAI,OAAOA,OAAO,CAACC,GAAf,KAAuB,WAAvC,EAAqD;AAAE;AACtDD,gBAAAA,OAAO,CAACC,GAAR,CAAaF,SAAS,CAACG,KAAvB,EADoD,CACpB;AAChC;AACD;AACD;AACD,SAbyC,CAaxCC,IAbwC,CAalC,IAbkC,CAA1C;AAcA;AACD,KAnCK;AAqCNE,IAAAA,EArCM,cAqCFf,SArCE,EAqCSM,QArCT,EAqCoB;AACzB,UAAMU,IAAI,GAAG,IAAb;AACAA,MAAAA,IAAI,CAACZ,cAAL,GAAsBY,IAAI,CAACZ,cAAL,IAAuB;AAAE,aAAK;AAAP,OAA7C;;AACA,UAAK,CAACY,IAAI,CAACZ,cAAL,CAAqBJ,SAArB,CAAN,EAAyC;AACxCgB,QAAAA,IAAI,CAACZ,cAAL,CAAqBJ,SAArB,IAAmC,EAAnC;AACA;;AACDgB,MAAAA,IAAI,CAACZ,cAAL,CAAqBJ,SAArB,EAAiCiB,IAAjC,CAAuCX,QAAvC;AACA,aAAO;AACNN,QAAAA,SAAS,EAATA,SADM;AAENM,QAAAA,QAAQ,EAARA,QAFM;AAGNY,QAAAA,GAHM,iBAGA;AACLF,UAAAA,IAAI,CAACE,GAAL,CAAUlB,SAAV,EAAqBM,QAArB;AACA;AALK,OAAP;AAOA,KAnDK;AAqDNY,IAAAA,GArDM,eAqDDlB,SArDC,EAqDUM,QArDV,EAqDqB;AAC1B,WAAKF,cAAL,GAAsB,KAAKA,cAAL,IAAuB;AAAE,aAAK;AAAP,OAA7C;;AACA,UAAK,CAACJ,SAAN,EAAkB;AACjB,aAAKI,cAAL,GAAsB,EAAtB;AACA,OAFD,MAEO,IAAKE,QAAL,EAAgB;AACtB,aAAKF,cAAL,CAAqBJ,SAArB,IAAmCH,CAAC,CAACsB,OAAF,CAAW,KAAKf,cAAL,CAAqBJ,SAArB,CAAX,EAA6CM,QAA7C,CAAnC;AACA,OAFM,MAEA;AACN,aAAKF,cAAL,CAAqBJ,SAArB,IAAmC,EAAnC;AACA;AACD;AA9DK,GAAP;AAgEA;;AAEDoB,MAAM,CAACC,OAAP,GAAiB;AAChBvB,EAAAA,WAAW,EAAXA,WADgB;AAEhBwB,EAAAA,QAAQ,EAAExB,WAAW;AAFL,CAAjB","sourceRoot":"/Users/jim/git/oss/machina/src/","sourcesContent":["const utils = require( \"./utils\" );\nconst _ = require( \"lodash\" );\n\nfunction getInstance() {\n\treturn {\n\t\temit( eventName ) {\n\t\t\tconst args = utils.getLeaklessArgs( arguments ); // eslint-disable-line prefer-rest-params\n\t\t\tif ( this.eventListeners[ \"*\" ] ) {\n\t\t\t\t_.each( this.eventListeners[ \"*\" ], function( callback ) {\n\t\t\t\t\tif ( !this.useSafeEmit ) {\n\t\t\t\t\t\tcallback.apply( this, args );\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tcallback.apply( this, args );\n\t\t\t\t\t\t} catch ( exception ) {\n\t\t\t\t\t\t\t/* istanbul ignore else  */\n\t\t\t\t\t\t\tif ( console && typeof console.log !== \"undefined\" ) { // eslint-disable-line no-console\n\t\t\t\t\t\t\t\tconsole.log( exception.stack ); // eslint-disable-line no-console\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}.bind( this ) );\n\t\t\t}\n\t\t\tif ( this.eventListeners[ eventName ] ) {\n\t\t\t\t_.each( this.eventListeners[ eventName ], function( callback ) {\n\t\t\t\t\tif ( !this.useSafeEmit ) {\n\t\t\t\t\t\tcallback.apply( this, args.slice( 1 ) );\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tcallback.apply( this, args.slice( 1 ) );\n\t\t\t\t\t\t} catch ( exception ) {\n\t\t\t\t\t\t\t/* istanbul ignore else  */\n\t\t\t\t\t\t\tif ( console && typeof console.log !== \"undefined\" ) { // eslint-disable-line no-console\n\t\t\t\t\t\t\t\tconsole.log( exception.stack ); // eslint-disable-line no-console\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}.bind( this ) );\n\t\t\t}\n\t\t},\n\n\t\ton( eventName, callback ) {\n\t\t\tconst self = this;\n\t\t\tself.eventListeners = self.eventListeners || { \"*\": [], };\n\t\t\tif ( !self.eventListeners[ eventName ] ) {\n\t\t\t\tself.eventListeners[ eventName ] = [];\n\t\t\t}\n\t\t\tself.eventListeners[ eventName ].push( callback );\n\t\t\treturn {\n\t\t\t\teventName,\n\t\t\t\tcallback,\n\t\t\t\toff() {\n\t\t\t\t\tself.off( eventName, callback );\n\t\t\t\t},\n\t\t\t};\n\t\t},\n\n\t\toff( eventName, callback ) {\n\t\t\tthis.eventListeners = this.eventListeners || { \"*\": [], };\n\t\t\tif ( !eventName ) {\n\t\t\t\tthis.eventListeners = {};\n\t\t\t} else if ( callback ) {\n\t\t\t\tthis.eventListeners[ eventName ] = _.without( this.eventListeners[ eventName ], callback );\n\t\t\t} else {\n\t\t\t\tthis.eventListeners[ eventName ] = [];\n\t\t\t}\n\t\t},\n\t};\n}\n\nmodule.exports = {\n\tgetInstance,\n\tinstance: getInstance(),\n};\n"]},"all":true},"/Users/jim/git/oss/machina/src/events.js":{"path":"/Users/jim/git/oss/machina/src/events.js","statementMap":{"0":{"start":{"line":3,"column":0},"end":{"line":13,"column":2}}},"fnMap":{},"branchMap":{},"s":{"0":0},"f":{},"b":{},"inputSourceMap":{"version":3,"sources":["events.js"],"names":["module","exports","NEXT_TRANSITION","HANDLING","HANDLED","NO_HANDLER","TRANSITION","TRANSITIONED","INVALID_STATE","DEFERRED","NEW_FSM"],"mappings":";;AAAAA,MAAM,CAACC,OAAP,GAAiB;AAChBC,EAAAA,eAAe,EAAE,YADD;AAEhBC,EAAAA,QAAQ,EAAE,UAFM;AAGhBC,EAAAA,OAAO,EAAE,SAHO;AAIhBC,EAAAA,UAAU,EAAE,WAJI;AAKhBC,EAAAA,UAAU,EAAE,YALI;AAMhBC,EAAAA,YAAY,EAAE,cANE;AAOhBC,EAAAA,aAAa,EAAE,cAPC;AAQhBC,EAAAA,QAAQ,EAAE,UARM;AAShBC,EAAAA,OAAO,EAAE;AATO,CAAjB","sourceRoot":"/Users/jim/git/oss/machina/src/","sourcesContent":["module.exports = {\n\tNEXT_TRANSITION: \"transition\",\n\tHANDLING: \"handling\",\n\tHANDLED: \"handled\",\n\tNO_HANDLER: \"nohandler\",\n\tTRANSITION: \"transition\",\n\tTRANSITIONED: \"transitioned\",\n\tINVALID_STATE: \"invalidstate\",\n\tDEFERRED: \"deferred\",\n\tNEW_FSM: \"newfsm\",\n};\n"]},"all":true},"/Users/jim/git/oss/machina/src/Fsm.js":{"path":"/Users/jim/git/oss/machina/src/Fsm.js","statementMap":{"0":{"start":{"line":3,"column":51},"end":{"line":3,"column":355}},"1":{"start":{"line":3,"column":126},"end":{"line":3,"column":181}},"2":{"start":{"line":3,"column":160},"end":{"line":3,"column":178}},"3":{"start":{"line":3,"column":191},"end":{"line":3,"column":353}},"4":{"start":{"line":3,"column":225},"end":{"line":3,"column":350}},"5":{"start":{"line":3,"column":356},"end":{"line":3,"column":376}},"6":{"start":{"line":5,"column":20},"end":{"line":5,"column":46}},"7":{"start":{"line":7,"column":12},"end":{"line":7,"column":30}},"8":{"start":{"line":9,"column":8},"end":{"line":9,"column":25}},"9":{"start":{"line":11,"column":10},"end":{"line":88,"column":1}},"10":{"start":{"line":13,"column":4},"end":{"line":13,"column":41}},"11":{"start":{"line":15,"column":4},"end":{"line":15,"column":28}},"12":{"start":{"line":18,"column":23},"end":{"line":18,"column":40}},"13":{"start":{"line":20,"column":4},"end":{"line":22,"column":5}},"14":{"start":{"line":21,"column":6},"end":{"line":21,"column":72}},"15":{"start":{"line":24,"column":4},"end":{"line":26,"column":5}},"16":{"start":{"line":25,"column":6},"end":{"line":25,"column":90}},"17":{"start":{"line":28,"column":4},"end":{"line":28,"column":34}},"18":{"start":{"line":31,"column":4},"end":{"line":37,"column":5}},"19":{"start":{"line":32,"column":6},"end":{"line":32,"column":27}},"20":{"start":{"line":34,"column":6},"end":{"line":34,"column":66}},"21":{"start":{"line":36,"column":6},"end":{"line":36,"column":24}},"22":{"start":{"line":39,"column":4},"end":{"line":39,"column":16}},"23":{"start":{"line":42,"column":16},"end":{"line":42,"column":20}},"24":{"start":{"line":45,"column":4},"end":{"line":49,"column":5}},"25":{"start":{"line":46,"column":6},"end":{"line":46,"column":31}},"26":{"start":{"line":47,"column":11},"end":{"line":49,"column":5}},"27":{"start":{"line":48,"column":6},"end":{"line":48,"column":26}},"28":{"start":{"line":51,"column":4},"end":{"line":51,"column":17}},"29":{"start":{"line":57,"column":16},"end":{"line":57,"column":20}},"30":{"start":{"line":58,"column":16},"end":{"line":58,"column":24}},"31":{"start":{"line":60,"column":4},"end":{"line":62,"column":5}},"32":{"start":{"line":61,"column":6},"end":{"line":61,"column":42}},"33":{"start":{"line":64,"column":4},"end":{"line":64,"column":56}},"34":{"start":{"line":69,"column":4},"end":{"line":69,"column":16}},"35":{"start":{"line":73,"column":15},"end":{"line":73,"column":69}},"36":{"start":{"line":75,"column":15},"end":{"line":75,"column":22}},"37":{"start":{"line":77,"column":4},"end":{"line":81,"column":5}},"38":{"start":{"line":78,"column":6},"end":{"line":80,"column":9}},"39":{"start":{"line":83,"column":4},"end":{"line":86,"column":6}},"40":{"start":{"line":90,"column":0},"end":{"line":96,"column":3}},"41":{"start":{"line":91,"column":2},"end":{"line":95,"column":4}},"42":{"start":{"line":92,"column":15},"end":{"line":92,"column":69}},"43":{"start":{"line":94,"column":4},"end":{"line":94,"column":79}},"44":{"start":{"line":98,"column":0},"end":{"line":98,"column":32}},"45":{"start":{"line":99,"column":0},"end":{"line":99,"column":21}}},"fnMap":{"0":{"name":"_typeof","decl":{"start":{"line":3,"column":9},"end":{"line":3,"column":16}},"loc":{"start":{"line":3,"column":22},"end":{"line":3,"column":378}},"line":3},"1":{"name":"_typeof","decl":{"start":{"line":3,"column":145},"end":{"line":3,"column":152}},"loc":{"start":{"line":3,"column":158},"end":{"line":3,"column":180}},"line":3},"2":{"name":"_typeof","decl":{"start":{"line":3,"column":210},"end":{"line":3,"column":217}},"loc":{"start":{"line":3,"column":223},"end":{"line":3,"column":352}},"line":3},"3":{"name":"constructor","decl":{"start":{"line":12,"column":24},"end":{"line":12,"column":35}},"loc":{"start":{"line":12,"column":38},"end":{"line":16,"column":3}},"line":12},"4":{"name":"initClient","decl":{"start":{"line":17,"column":23},"end":{"line":17,"column":33}},"loc":{"start":{"line":17,"column":36},"end":{"line":29,"column":3}},"line":17},"5":{"name":"ensureClientMeta","decl":{"start":{"line":30,"column":29},"end":{"line":30,"column":45}},"loc":{"start":{"line":30,"column":48},"end":{"line":40,"column":3}},"line":30},"6":{"name":"ensureClientArg","decl":{"start":{"line":41,"column":28},"end":{"line":41,"column":43}},"loc":{"start":{"line":41,"column":50},"end":{"line":52,"column":3}},"line":41},"7":{"name":"getHandlerArgs","decl":{"start":{"line":53,"column":27},"end":{"line":53,"column":41}},"loc":{"start":{"line":53,"column":60},"end":{"line":65,"column":3}},"line":53},"8":{"name":"getSystemHandlerArgs","decl":{"start":{"line":66,"column":33},"end":{"line":66,"column":53}},"loc":{"start":{"line":68,"column":4},"end":{"line":70,"column":3}},"line":68},"9":{"name":"buildEventPayload","decl":{"start":{"line":72,"column":30},"end":{"line":72,"column":47}},"loc":{"start":{"line":72,"column":50},"end":{"line":87,"column":3}},"line":72},"10":{"name":"(anonymous_10)","decl":{"start":{"line":90,"column":87},"end":{"line":90,"column":88}},"loc":{"start":{"line":90,"column":123},"end":{"line":96,"column":1}},"line":90},"11":{"name":"(anonymous_11)","decl":{"start":{"line":91,"column":34},"end":{"line":91,"column":35}},"loc":{"start":{"line":91,"column":46},"end":{"line":95,"column":3}},"line":91}},"branchMap":{"0":{"loc":{"start":{"line":3,"column":51},"end":{"line":3,"column":355}},"type":"if","locations":[{"start":{"line":3,"column":51},"end":{"line":3,"column":355}},{"start":{"line":3,"column":51},"end":{"line":3,"column":355}}],"line":3},"1":{"loc":{"start":{"line":3,"column":55},"end":{"line":3,"column":122}},"type":"binary-expr","locations":[{"start":{"line":3,"column":55},"end":{"line":3,"column":83}},{"start":{"line":3,"column":87},"end":{"line":3,"column":122}}],"line":3},"2":{"loc":{"start":{"line":3,"column":232},"end":{"line":3,"column":349}},"type":"cond-expr","locations":[{"start":{"line":3,"column":328},"end":{"line":3,"column":336}},{"start":{"line":3,"column":339},"end":{"line":3,"column":349}}],"line":3},"3":{"loc":{"start":{"line":3,"column":232},"end":{"line":3,"column":325}},"type":"binary-expr","locations":[{"start":{"line":3,"column":232},"end":{"line":3,"column":235}},{"start":{"line":3,"column":239},"end":{"line":3,"column":267}},{"start":{"line":3,"column":271},"end":{"line":3,"column":297}},{"start":{"line":3,"column":301},"end":{"line":3,"column":325}}],"line":3},"4":{"loc":{"start":{"line":20,"column":4},"end":{"line":22,"column":5}},"type":"if","locations":[{"start":{"line":20,"column":4},"end":{"line":22,"column":5}},{"start":{"line":20,"column":4},"end":{"line":22,"column":5}}],"line":20},"5":{"loc":{"start":{"line":24,"column":4},"end":{"line":26,"column":5}},"type":"if","locations":[{"start":{"line":24,"column":4},"end":{"line":26,"column":5}},{"start":{"line":24,"column":4},"end":{"line":26,"column":5}}],"line":24},"6":{"loc":{"start":{"line":31,"column":4},"end":{"line":37,"column":5}},"type":"if","locations":[{"start":{"line":31,"column":4},"end":{"line":37,"column":5}},{"start":{"line":31,"column":4},"end":{"line":37,"column":5}}],"line":31},"7":{"loc":{"start":{"line":45,"column":4},"end":{"line":49,"column":5}},"type":"if","locations":[{"start":{"line":45,"column":4},"end":{"line":49,"column":5}},{"start":{"line":45,"column":4},"end":{"line":49,"column":5}}],"line":45},"8":{"loc":{"start":{"line":45,"column":8},"end":{"line":45,"column":89}},"type":"binary-expr","locations":[{"start":{"line":45,"column":8},"end":{"line":45,"column":38}},{"start":{"line":45,"column":42},"end":{"line":45,"column":68}},{"start":{"line":45,"column":72},"end":{"line":45,"column":89}}],"line":45},"9":{"loc":{"start":{"line":47,"column":11},"end":{"line":49,"column":5}},"type":"if","locations":[{"start":{"line":47,"column":11},"end":{"line":49,"column":5}},{"start":{"line":47,"column":11},"end":{"line":49,"column":5}}],"line":47},"10":{"loc":{"start":{"line":47,"column":15},"end":{"line":47,"column":106}},"type":"binary-expr","locations":[{"start":{"line":47,"column":15},"end":{"line":47,"column":45}},{"start":{"line":47,"column":49},"end":{"line":47,"column":79}},{"start":{"line":47,"column":83},"end":{"line":47,"column":106}}],"line":47},"11":{"loc":{"start":{"line":60,"column":4},"end":{"line":62,"column":5}},"type":"if","locations":[{"start":{"line":60,"column":4},"end":{"line":62,"column":5}},{"start":{"line":60,"column":4},"end":{"line":62,"column":5}}],"line":60},"12":{"loc":{"start":{"line":60,"column":9},"end":{"line":60,"column":76}},"type":"cond-expr","locations":[{"start":{"line":60,"column":44},"end":{"line":60,"column":55}},{"start":{"line":60,"column":58},"end":{"line":60,"column":76}}],"line":60},"13":{"loc":{"start":{"line":64,"column":11},"end":{"line":64,"column":55}},"type":"cond-expr","locations":[{"start":{"line":64,"column":24},"end":{"line":64,"column":38}},{"start":{"line":64,"column":41},"end":{"line":64,"column":55}}],"line":64},"14":{"loc":{"start":{"line":77,"column":4},"end":{"line":81,"column":5}},"type":"if","locations":[{"start":{"line":77,"column":4},"end":{"line":81,"column":5}},{"start":{"line":77,"column":4},"end":{"line":81,"column":5}}],"line":77},"15":{"loc":{"start":{"line":84,"column":12},"end":{"line":84,"column":24}},"type":"binary-expr","locations":[{"start":{"line":84,"column":12},"end":{"line":84,"column":16}},{"start":{"line":84,"column":20},"end":{"line":84,"column":24}}],"line":84}},"s":{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0},"f":{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0},"b":{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0,0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0,0],"9":[0,0],"10":[0,0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0]},"inputSourceMap":{"version":3,"sources":["Fsm.js"],"names":["BehavioralFsm","require","utils","_","Fsm","constructor","apply","arguments","ensureClientMeta","initClient","initialState","Error","states","transition","_stamped","defaults","cloneDeep","getDefaultClientMeta","ensureClientArg","args","_args","splice","unshift","getHandlerArgs","isCatchAll","input","inputType","slice","getSystemHandlerArgs","buildEventPayload","getLeaklessArgs","data","isPlainObject","extend","namespace","each","methodWithClientInjected","prototype","module","exports"],"mappings":"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","sourceRoot":"/Users/jim/git/oss/machina/src/","sourcesContent":["const BehavioralFsm = require( \"./BehavioralFsm\" );\nconst utils = require( \"./utils\" );\nconst _ = require( \"lodash\" );\n\nlet Fsm = {\n\tconstructor() {\n\t\tBehavioralFsm.apply( this, arguments ); // eslint-disable-line prefer-rest-params\n\t\tthis.ensureClientMeta();\n\t},\n\tinitClient: function initClient() {\n\t\tconst initialState = this.initialState;\n\t\tif ( !initialState ) {\n\t\t\tthrow new Error( \"You must specify an initial state for this FSM\" );\n\t\t}\n\t\tif ( !this.states[ initialState ] ) {\n\t\t\tthrow new Error( \"The initial state specified does not exist in the states object.\" );\n\t\t}\n\t\tthis.transition( initialState );\n\t},\n\tensureClientMeta: function ensureClientMeta() {\n\t\tif ( !this._stamped ) {\n\t\t\tthis._stamped = true;\n\t\t\t_.defaults( this, _.cloneDeep( utils.getDefaultClientMeta() ) );\n\t\t\tthis.initClient();\n\t\t}\n\t\treturn this;\n\t},\n\n\tensureClientArg( args ) {\n\t\tconst _args = args;\n\t\t// we need to test the args and verify that if a client arg has\n\t\t// been passed, it must be this FSM instance (this isn't a behavioral FSM)\n\t\tif ( typeof _args[ 0 ] === \"object\" && !( \"inputType\" in _args[ 0 ] ) && _args[ 0 ] !== this ) {\n\t\t\t_args.splice( 0, 1, this );\n\t\t} else if ( typeof _args[ 0 ] !== \"object\" || ( typeof _args[ 0 ] === \"object\" && ( \"inputType\" in _args[ 0 ] ) ) ) {\n\t\t\t_args.unshift( this );\n\t\t}\n\t\treturn _args;\n\t},\n\n\tgetHandlerArgs( args, isCatchAll ) {\n\t\t// index 0 is the client, index 1 is inputType\n\t\t// if we're in a catch-all handler, input type needs to be included in the args\n\t\t// inputType might be an object, so we need to just get the inputType string if so\n\t\tconst _args = args;\n\t\tconst input = _args[ 1 ];\n\t\tif ( typeof inputType === \"object\" ) {\n\t\t\t_args.splice( 1, 1, input.inputType );\n\t\t}\n\t\treturn isCatchAll ?\n\t\t\t_args.slice( 1 ) :\n\t\t\t_args.slice( 2 );\n\t},\n\n\tgetSystemHandlerArgs( args /* client */ ) {\n\t\treturn args;\n\t},\n\n\t// \"classic\" machina FSM do not emit the client property on events (which would be the FSM itself)\n\tbuildEventPayload() {\n\t\tconst args = this.ensureClientArg( utils.getLeaklessArgs( arguments ) ); // eslint-disable-line prefer-rest-params\n\t\tconst data = args[ 1 ];\n\t\tif ( _.isPlainObject( data ) ) {\n\t\t\treturn _.extend( data, { namespace: this.namespace, } );\n\t\t}\n\t\treturn { data: data || null, namespace: this.namespace, };\n\t},\n};\n\n_.each( [\n\t\"handle\",\n\t\"transition\",\n\t\"deferUntilTransition\",\n\t\"processQueue\",\n\t\"clearQueue\",\n], function( methodWithClientInjected ) {\n\tFsm[ methodWithClientInjected ] = function() {\n\t\tconst args = this.ensureClientArg( utils.getLeaklessArgs( arguments ) ); // eslint-disable-line prefer-rest-params\n\t\treturn BehavioralFsm.prototype[ methodWithClientInjected ].apply( this, args );\n\t};\n} );\n\nFsm = BehavioralFsm.extend( Fsm );\n\nmodule.exports = Fsm;\n"]},"all":true},"/Users/jim/git/oss/machina/src/machina.js":{"path":"/Users/jim/git/oss/machina/src/machina.js","statementMap":{"0":{"start":{"line":3,"column":8},"end":{"line":3,"column":25}},"1":{"start":{"line":5,"column":14},"end":{"line":5,"column":34}},"2":{"start":{"line":7,"column":0},"end":{"line":14,"column":3}}},"fnMap":{},"branchMap":{},"s":{"0":0,"1":0,"2":0},"f":{},"b":{},"inputSourceMap":{"version":3,"sources":["machina.js"],"names":["_","require","emitter","module","exports","merge","instance","Fsm","BehavioralFsm","utils","eventListeners","newFsm"],"mappings":";;AAAA,IAAMA,CAAC,GAAGC,OAAO,CAAE,QAAF,CAAjB;;AACA,IAAMC,OAAO,GAAGD,OAAO,CAAE,WAAF,CAAvB;;AAEAE,MAAM,CAACC,OAAP,GAAiBJ,CAAC,CAACK,KAAF,CAASH,OAAO,CAACI,QAAjB,EAA2B;AAC3CC,EAAAA,GAAG,EAAEN,OAAO,CAAE,OAAF,CAD+B;AAE3CO,EAAAA,aAAa,EAAEP,OAAO,CAAE,iBAAF,CAFqB;AAG3CQ,EAAAA,KAAK,EAAER,OAAO,CAAE,SAAF,CAH6B;AAI3CS,EAAAA,cAAc,EAAE;AACfC,IAAAA,MAAM,EAAE;AADO;AAJ2B,CAA3B,CAAjB","sourceRoot":"/Users/jim/git/oss/machina/src/","sourcesContent":["const _ = require( \"lodash\" );\nconst emitter = require( \"./emitter\" );\n\nmodule.exports = _.merge( emitter.instance, {\n\tFsm: require( \"./Fsm\" ),\n\tBehavioralFsm: require( \"./BehavioralFsm\" ),\n\tutils: require( \"./utils\" ),\n\teventListeners: {\n\t\tnewFsm: [],\n\t},\n} );\n"]},"all":true},"/Users/jim/git/oss/machina/src/utils.js":{"path":"/Users/jim/git/oss/machina/src/utils.js","statementMap":{"0":{"start":{"line":3,"column":51},"end":{"line":3,"column":355}},"1":{"start":{"line":3,"column":126},"end":{"line":3,"column":181}},"2":{"start":{"line":3,"column":160},"end":{"line":3,"column":178}},"3":{"start":{"line":3,"column":191},"end":{"line":3,"column":353}},"4":{"start":{"line":3,"column":225},"end":{"line":3,"column":350}},"5":{"start":{"line":3,"column":356},"end":{"line":3,"column":376}},"6":{"start":{"line":5,"column":13},"end":{"line":5,"column":35}},"7":{"start":{"line":7,"column":8},"end":{"line":7,"column":25}},"8":{"start":{"line":9,"column":23},"end":{"line":14,"column":3}},"9":{"start":{"line":10,"column":21},"end":{"line":10,"column":22}},"10":{"start":{"line":11,"column":2},"end":{"line":13,"column":4}},"11":{"start":{"line":12,"column":4},"end":{"line":12,"column":41}},"12":{"start":{"line":17,"column":2},"end":{"line":27,"column":4}},"13":{"start":{"line":31,"column":2},"end":{"line":40,"column":4}},"14":{"start":{"line":44,"column":15},"end":{"line":44,"column":17}},"15":{"start":{"line":46,"column":2},"end":{"line":48,"column":3}},"16":{"start":{"line":46,"column":15},"end":{"line":46,"column":28}},"17":{"start":{"line":47,"column":4},"end":{"line":47,"column":24}},"18":{"start":{"line":50,"column":2},"end":{"line":50,"column":16}},"19":{"start":{"line":63,"column":2},"end":{"line":65,"column":3}},"20":{"start":{"line":64,"column":4},"end":{"line":64,"column":11}},"21":{"start":{"line":67,"column":27},"end":{"line":67,"column":29}},"22":{"start":{"line":69,"column":2},"end":{"line":82,"column":3}},"23":{"start":{"line":71,"column":4},"end":{"line":79,"column":5}},"24":{"start":{"line":72,"column":6},"end":{"line":72,"column":34}},"25":{"start":{"line":73,"column":6},"end":{"line":73,"column":65}},"26":{"start":{"line":76,"column":6},"end":{"line":78,"column":8}},"27":{"start":{"line":77,"column":8},"end":{"line":77,"column":22}},"28":{"start":{"line":80,"column":9},"end":{"line":82,"column":3}},"29":{"start":{"line":81,"column":4},"end":{"line":81,"column":40}},"30":{"start":{"line":84,"column":2},"end":{"line":84,"column":61}},"31":{"start":{"line":85,"column":2},"end":{"line":85,"column":28}},"32":{"start":{"line":91,"column":2},"end":{"line":124,"column":5}},"33":{"start":{"line":94,"column":4},"end":{"line":123,"column":5}},"34":{"start":{"line":96,"column":8},"end":{"line":99,"column":9}},"35":{"start":{"line":98,"column":10},"end":{"line":98,"column":39}},"36":{"start":{"line":102,"column":8},"end":{"line":104,"column":9}},"37":{"start":{"line":103,"column":10},"end":{"line":103,"column":43}},"38":{"start":{"line":106,"column":8},"end":{"line":106,"column":14}},"39":{"start":{"line":109,"column":8},"end":{"line":109,"column":29}},"40":{"start":{"line":111,"column":8},"end":{"line":113,"column":9}},"41":{"start":{"line":112,"column":10},"end":{"line":112,"column":48}},"42":{"start":{"line":115,"column":8},"end":{"line":115,"column":34}},"43":{"start":{"line":117,"column":8},"end":{"line":117,"column":14}},"44":{"start":{"line":120,"column":8},"end":{"line":120,"column":34}},"45":{"start":{"line":122,"column":8},"end":{"line":122,"column":14}},"46":{"start":{"line":130,"column":16},"end":{"line":130,"column":42}},"47":{"start":{"line":132,"column":13},"end":{"line":202,"column":1}},"48":{"start":{"line":133,"column":15},"end":{"line":133,"column":19}},"49":{"start":{"line":137,"column":16},"end":{"line":137,"column":18}},"50":{"start":{"line":139,"column":13},"end":{"line":139,"column":31}},"51":{"start":{"line":145,"column":2},"end":{"line":171,"column":3}},"52":{"start":{"line":146,"column":4},"end":{"line":146,"column":33}},"53":{"start":{"line":153,"column":4},"end":{"line":170,"column":6}},"54":{"start":{"line":154,"column":6},"end":{"line":156,"column":7}},"55":{"start":{"line":154,"column":22},"end":{"line":154,"column":38}},"56":{"start":{"line":154,"column":47},"end":{"line":154,"column":62}},"57":{"start":{"line":154,"column":71},"end":{"line":154,"column":72}},"58":{"start":{"line":155,"column":8},"end":{"line":155,"column":37}},"59":{"start":{"line":158,"column":6},"end":{"line":158,"column":30}},"60":{"start":{"line":159,"column":27},"end":{"line":159,"column":47}},"61":{"start":{"line":161,"column":25},"end":{"line":163,"column":8}},"62":{"start":{"line":165,"column":6},"end":{"line":165,"column":76}},"63":{"start":{"line":167,"column":6},"end":{"line":167,"column":38}},"64":{"start":{"line":169,"column":6},"end":{"line":169,"column":31}},"65":{"start":{"line":174,"column":2},"end":{"line":174,"column":23}},"66":{"start":{"line":178,"column":2},"end":{"line":178,"column":36}},"67":{"start":{"line":179,"column":2},"end":{"line":179,"column":29}},"68":{"start":{"line":182,"column":2},"end":{"line":190,"column":3}},"69":{"start":{"line":183,"column":4},"end":{"line":183,"column":40}},"70":{"start":{"line":185,"column":4},"end":{"line":189,"column":8}},"71":{"start":{"line":186,"column":6},"end":{"line":188,"column":7}},"72":{"start":{"line":187,"column":8},"end":{"line":187,"column":25}},"73":{"start":{"line":193,"column":2},"end":{"line":195,"column":3}},"74":{"start":{"line":194,"column":4},"end":{"line":194,"column":30}},"75":{"start":{"line":198,"column":2},"end":{"line":198,"column":34}},"76":{"start":{"line":200,"column":2},"end":{"line":200,"column":35}},"77":{"start":{"line":201,"column":2},"end":{"line":201,"column":13}},"78":{"start":{"line":207,"column":10},"end":{"line":207,"column":12}},"79":{"start":{"line":208,"column":18},"end":{"line":208,"column":36}},"80":{"start":{"line":210,"column":2},"end":{"line":212,"column":3}},"81":{"start":{"line":210,"column":15},"end":{"line":210,"column":16}},"82":{"start":{"line":211,"column":4},"end":{"line":211,"column":65}},"83":{"start":{"line":214,"column":2},"end":{"line":214,"column":14}},"84":{"start":{"line":218,"column":2},"end":{"line":218,"column":49}},"85":{"start":{"line":222,"column":2},"end":{"line":222,"column":37}},"86":{"start":{"line":223,"column":2},"end":{"line":223,"column":20}},"87":{"start":{"line":228,"column":0},"end":{"line":238,"column":2}}},"fnMap":{"0":{"name":"_typeof","decl":{"start":{"line":3,"column":9},"end":{"line":3,"column":16}},"loc":{"start":{"line":3,"column":22},"end":{"line":3,"column":378}},"line":3},"1":{"name":"_typeof","decl":{"start":{"line":3,"column":145},"end":{"line":3,"column":152}},"loc":{"start":{"line":3,"column":158},"end":{"line":3,"column":180}},"line":3},"2":{"name":"_typeof","decl":{"start":{"line":3,"column":210},"end":{"line":3,"column":217}},"loc":{"start":{"line":3,"column":223},"end":{"line":3,"column":352}},"line":3},"3":{"name":"(anonymous_3)","decl":{"start":{"line":9,"column":23},"end":{"line":9,"column":24}},"loc":{"start":{"line":9,"column":35},"end":{"line":14,"column":1}},"line":9},"4":{"name":"(anonymous_4)","decl":{"start":{"line":11,"column":9},"end":{"line":11,"column":10}},"loc":{"start":{"line":11,"column":21},"end":{"line":13,"column":3}},"line":11},"5":{"name":"getDefaultBehavioralOptions","decl":{"start":{"line":16,"column":9},"end":{"line":16,"column":36}},"loc":{"start":{"line":16,"column":39},"end":{"line":28,"column":1}},"line":16},"6":{"name":"getDefaultClientMeta","decl":{"start":{"line":30,"column":9},"end":{"line":30,"column":29}},"loc":{"start":{"line":30,"column":32},"end":{"line":41,"column":1}},"line":30},"7":{"name":"getLeaklessArgs","decl":{"start":{"line":43,"column":9},"end":{"line":43,"column":24}},"loc":{"start":{"line":43,"column":41},"end":{"line":51,"column":1}},"line":43},"8":{"name":"getChildFsmInstance","decl":{"start":{"line":62,"column":9},"end":{"line":62,"column":28}},"loc":{"start":{"line":62,"column":37},"end":{"line":86,"column":1}},"line":62},"9":{"name":"(anonymous_9)","decl":{"start":{"line":76,"column":35},"end":{"line":76,"column":36}},"loc":{"start":{"line":76,"column":47},"end":{"line":78,"column":7}},"line":76},"10":{"name":"listenToChild","decl":{"start":{"line":88,"column":9},"end":{"line":88,"column":22}},"loc":{"start":{"line":88,"column":35},"end":{"line":125,"column":1}},"line":88},"11":{"name":"(anonymous_11)","decl":{"start":{"line":91,"column":23},"end":{"line":91,"column":24}},"loc":{"start":{"line":91,"column":50},"end":{"line":124,"column":3}},"line":91},"12":{"name":"extend","decl":{"start":{"line":132,"column":22},"end":{"line":132,"column":28}},"loc":{"start":{"line":132,"column":54},"end":{"line":202,"column":1}},"line":132},"13":{"name":"Ctor","decl":{"start":{"line":139,"column":22},"end":{"line":139,"column":26}},"loc":{"start":{"line":139,"column":29},"end":{"line":139,"column":31}},"line":139},"14":{"name":"fsm","decl":{"start":{"line":153,"column":19},"end":{"line":153,"column":22}},"loc":{"start":{"line":153,"column":25},"end":{"line":170,"column":5}},"line":153},"15":{"name":"(anonymous_15)","decl":{"start":{"line":185,"column":45},"end":{"line":185,"column":46}},"loc":{"start":{"line":185,"column":72},"end":{"line":189,"column":5}},"line":185},"16":{"name":"createUUID","decl":{"start":{"line":206,"column":9},"end":{"line":206,"column":19}},"loc":{"start":{"line":206,"column":22},"end":{"line":224,"column":1}},"line":206}},"branchMap":{"0":{"loc":{"start":{"line":3,"column":51},"end":{"line":3,"column":355}},"type":"if","locations":[{"start":{"line":3,"column":51},"end":{"line":3,"column":355}},{"start":{"line":3,"column":51},"end":{"line":3,"column":355}}],"line":3},"1":{"loc":{"start":{"line":3,"column":55},"end":{"line":3,"column":122}},"type":"binary-expr","locations":[{"start":{"line":3,"column":55},"end":{"line":3,"column":83}},{"start":{"line":3,"column":87},"end":{"line":3,"column":122}}],"line":3},"2":{"loc":{"start":{"line":3,"column":232},"end":{"line":3,"column":349}},"type":"cond-expr","locations":[{"start":{"line":3,"column":328},"end":{"line":3,"column":336}},{"start":{"line":3,"column":339},"end":{"line":3,"column":349}}],"line":3},"3":{"loc":{"start":{"line":3,"column":232},"end":{"line":3,"column":325}},"type":"binary-expr","locations":[{"start":{"line":3,"column":232},"end":{"line":3,"column":235}},{"start":{"line":3,"column":239},"end":{"line":3,"column":267}},{"start":{"line":3,"column":271},"end":{"line":3,"column":297}},{"start":{"line":3,"column":301},"end":{"line":3,"column":325}}],"line":3},"4":{"loc":{"start":{"line":46,"column":15},"end":{"line":46,"column":28}},"type":"binary-expr","locations":[{"start":{"line":46,"column":15},"end":{"line":46,"column":23}},{"start":{"line":46,"column":27},"end":{"line":46,"column":28}}],"line":46},"5":{"loc":{"start":{"line":63,"column":2},"end":{"line":65,"column":3}},"type":"if","locations":[{"start":{"line":63,"column":2},"end":{"line":65,"column":3}},{"start":{"line":63,"column":2},"end":{"line":65,"column":3}}],"line":63},"6":{"loc":{"start":{"line":69,"column":2},"end":{"line":82,"column":3}},"type":"if","locations":[{"start":{"line":69,"column":2},"end":{"line":82,"column":3}},{"start":{"line":69,"column":2},"end":{"line":82,"column":3}}],"line":69},"7":{"loc":{"start":{"line":71,"column":4},"end":{"line":79,"column":5}},"type":"if","locations":[{"start":{"line":71,"column":4},"end":{"line":79,"column":5}},{"start":{"line":71,"column":4},"end":{"line":79,"column":5}}],"line":71},"8":{"loc":{"start":{"line":80,"column":9},"end":{"line":82,"column":3}},"type":"if","locations":[{"start":{"line":80,"column":9},"end":{"line":82,"column":3}},{"start":{"line":80,"column":9},"end":{"line":82,"column":3}}],"line":80},"9":{"loc":{"start":{"line":94,"column":4},"end":{"line":123,"column":5}},"type":"switch","locations":[{"start":{"line":95,"column":6},"end":{"line":106,"column":14}},{"start":{"line":108,"column":6},"end":{"line":117,"column":14}},{"start":{"line":119,"column":6},"end":{"line":122,"column":14}}],"line":94},"10":{"loc":{"start":{"line":96,"column":8},"end":{"line":99,"column":9}},"type":"if","locations":[{"start":{"line":96,"column":8},"end":{"line":99,"column":9}},{"start":{"line":96,"column":8},"end":{"line":99,"column":9}}],"line":96},"11":{"loc":{"start":{"line":96,"column":12},"end":{"line":96,"column":79}},"type":"binary-expr","locations":[{"start":{"line":96,"column":12},"end":{"line":96,"column":24}},{"start":{"line":96,"column":28},"end":{"line":96,"column":43}},{"start":{"line":96,"column":47},"end":{"line":96,"column":79}}],"line":96},"12":{"loc":{"start":{"line":102,"column":8},"end":{"line":104,"column":9}},"type":"if","locations":[{"start":{"line":102,"column":8},"end":{"line":104,"column":9}},{"start":{"line":102,"column":8},"end":{"line":104,"column":9}}],"line":102},"13":{"loc":{"start":{"line":111,"column":8},"end":{"line":113,"column":9}},"type":"if","locations":[{"start":{"line":111,"column":8},"end":{"line":113,"column":9}},{"start":{"line":111,"column":8},"end":{"line":113,"column":9}}],"line":111},"14":{"loc":{"start":{"line":111,"column":12},"end":{"line":111,"column":52}},"type":"binary-expr","locations":[{"start":{"line":111,"column":12},"end":{"line":111,"column":18}},{"start":{"line":111,"column":22},"end":{"line":111,"column":52}}],"line":111},"15":{"loc":{"start":{"line":145,"column":2},"end":{"line":171,"column":3}},"type":"if","locations":[{"start":{"line":145,"column":2},"end":{"line":171,"column":3}},{"start":{"line":145,"column":2},"end":{"line":171,"column":3}}],"line":145},"16":{"loc":{"start":{"line":145,"column":6},"end":{"line":145,"column":60}},"type":"binary-expr","locations":[{"start":{"line":145,"column":6},"end":{"line":145,"column":16}},{"start":{"line":145,"column":20},"end":{"line":145,"column":60}}],"line":145},"17":{"loc":{"start":{"line":158,"column":16},"end":{"line":158,"column":29}},"type":"binary-expr","locations":[{"start":{"line":158,"column":16},"end":{"line":158,"column":23}},{"start":{"line":158,"column":27},"end":{"line":158,"column":29}}],"line":158},"18":{"loc":{"start":{"line":159,"column":27},"end":{"line":159,"column":47}},"type":"binary-expr","locations":[{"start":{"line":159,"column":27},"end":{"line":159,"column":41}},{"start":{"line":159,"column":45},"end":{"line":159,"column":47}}],"line":159},"19":{"loc":{"start":{"line":165,"column":34},"end":{"line":165,"column":75}},"type":"binary-expr","locations":[{"start":{"line":165,"column":34},"end":{"line":165,"column":54}},{"start":{"line":165,"column":58},"end":{"line":165,"column":75}}],"line":165},"20":{"loc":{"start":{"line":182,"column":2},"end":{"line":190,"column":3}},"type":"if","locations":[{"start":{"line":182,"column":2},"end":{"line":190,"column":3}},{"start":{"line":182,"column":2},"end":{"line":190,"column":3}}],"line":182},"21":{"loc":{"start":{"line":186,"column":6},"end":{"line":188,"column":7}},"type":"if","locations":[{"start":{"line":186,"column":6},"end":{"line":188,"column":7}},{"start":{"line":186,"column":6},"end":{"line":188,"column":7}}],"line":186},"22":{"loc":{"start":{"line":193,"column":2},"end":{"line":195,"column":3}},"type":"if","locations":[{"start":{"line":193,"column":2},"end":{"line":195,"column":3}},{"start":{"line":193,"column":2},"end":{"line":195,"column":3}}],"line":193}},"s":{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0,"81":0,"82":0,"83":0,"84":0,"85":0,"86":0,"87":0},"f":{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0},"b":{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0,0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0,0],"10":[0,0],"11":[0,0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0],"21":[0,0],"22":[0,0]},"inputSourceMap":{"version":3,"sources":["utils.js"],"names":["events","require","_","makeFsmNamespace","machinaCount","getDefaultBehavioralOptions","initialState","eventListeners","states","namespace","useSafeEmit","hierarchy","pendingDelegations","getDefaultClientMeta","inputQueue","targetReplayState","state","undefined","priorState","priorAction","currentAction","currentActionArgs","inExitHandler","getLeaklessArgs","args","startIdx","result","i","length","getChildFsmInstance","config","childFsmDefinition","factory","instance","listenToChild","fsm","child","on","eventName","data","ticket","NO_HANDLER","delegated","bubbling","inputType","handle","apply","HANDLING","emit","_machKeys","extend","protoProps","staticProps","parent","machObj","Ctor","hasOwnProperty","constructor","instanceStates","blendedState","merge","cloneDeep","prototype","transform","accum","val","key","indexOf","__super__","createUUID","s","hexDigits","substr","Math","floor","random","join","module","exports","getDefaultOptions"],"mappings":"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","sourceRoot":"/Users/jim/git/oss/machina/src/","sourcesContent":["const events = require( \"./events.js\" );\nconst _ = require( \"lodash\" );\n\nconst makeFsmNamespace = ( function() {\n\tlet machinaCount = 0;\n\treturn function() {\n\t\treturn `fsm.${ machinaCount++ }`;\n\t};\n}() );\n\nfunction getDefaultBehavioralOptions() {\n\treturn {\n\t\tinitialState: \"uninitialized\",\n\t\teventListeners: {\n\t\t\t\"*\": [],\n\t\t},\n\t\tstates: {},\n\t\tnamespace: makeFsmNamespace(),\n\t\tuseSafeEmit: false,\n\t\thierarchy: {},\n\t\tpendingDelegations: {},\n\t};\n}\n\nfunction getDefaultClientMeta() {\n\treturn {\n\t\tinputQueue: [],\n\t\ttargetReplayState: \"\",\n\t\tstate: undefined,\n\t\tpriorState: undefined,\n\t\tpriorAction: \"\",\n\t\tcurrentAction: \"\",\n\t\tcurrentActionArgs: undefined,\n\t\tinExitHandler: false,\n\t};\n}\n\nfunction getLeaklessArgs( args, startIdx ) {\n\tconst result = [];\n\tfor ( let i = ( startIdx || 0 ); i < args.length; i++ ) {\n\t\tresult[ i ] = args[ i ];\n\t}\n\treturn result;\n}\n/*\n\thandle ->\n\t\tchild = stateObj._child && stateObj._child.instance;\n\n\ttransition ->\n\t\tnewStateObj._child = getChildFsmInstance( newStateObj._child );\n\t\tchild = newStateObj._child && newStateObj._child.instance;\n*/\nfunction getChildFsmInstance( config ) {\n\tif ( !config ) {\n\t\treturn;\n\t}\n\tlet childFsmDefinition = {};\n\tif ( typeof config === \"object\" ) {\n\t\t// is this a config object with a factory?\n\t\tif ( config.factory ) {\n\t\t\tchildFsmDefinition = config;\n\t\t\tchildFsmDefinition.instance = childFsmDefinition.factory();\n\t\t} else {\n\t\t\t// assuming this is a machina instance\n\t\t\tchildFsmDefinition.factory = function() {\n\t\t\t\treturn config;\n\t\t\t};\n\t\t}\n\t} else if ( typeof config === \"function\" ) {\n\t\tchildFsmDefinition.factory = config;\n\t}\n\tchildFsmDefinition.instance = childFsmDefinition.factory();\n\treturn childFsmDefinition;\n}\n\nfunction listenToChild( fsm, child ) {\n\t// Need to investigate potential for discarded event\n\t// listener memory leak in long-running, deeply-nested hierarchies.\n\treturn child.on( \"*\", function( eventName, data ) {\n\t\tlet ticket;\n\t\tswitch ( eventName ) {\n\t\tcase events.NO_HANDLER:\n\t\t\tif ( !data.ticket && !data.delegated && data.namespace !== fsm.namespace ) {\n\t\t\t\t// Ok - we're dealing w/ a child handling input that should bubble up\n\t\t\t\tdata.args[ 1 ].bubbling = true;\n\t\t\t}\n\t\t\t// we do NOT bubble _reset inputs up to the parent\n\t\t\tif ( data.inputType !== \"_reset\" ) {\n\t\t\t\tfsm.handle.apply( fsm, data.args ); // eslint-disable-line prefer-spread\n\t\t\t}\n\t\t\tbreak;\n\t\tcase events.HANDLING :\n\t\t\tticket = data.ticket;\n\t\t\tif ( ticket && fsm.pendingDelegations[ ticket ] ) {\n\t\t\t\tdelete fsm.pendingDelegations[ ticket ];\n\t\t\t}\n\t\t\tfsm.emit( eventName, data ); // possibly transform payload?\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tfsm.emit( eventName, data ); // possibly transform payload?\n\t\t\tbreak;\n\t\t}\n\t} );\n}\n\n// _machKeys are members we want to track across the prototype chain of an extended FSM constructor\n// Since we want to eventually merge the aggregate of those values onto the instance so that FSMs\n// that share the same extended prototype won't share state *on* those prototypes.\nconst _machKeys = [ \"states\", \"initialState\", ];\nconst extend = function( protoProps, staticProps ) {\n\tconst parent = this; // eslint-disable-line no-invalid-this, consistent-this\n\tlet fsm; // placeholder for instance constructor\n\tconst machObj = {}; // object used to hold initialState & states from prototype for instance-level merging\n\tconst Ctor = function() {}; // placeholder ctor function used to insert level in prototype chain\n\n\t// The constructor function for the new subclass is either defined by you\n\t// (the \"constructor\" property in your `extend` definition), or defaulted\n\t// by us to simply call the parent's constructor.\n\tif ( protoProps && protoProps.hasOwnProperty( \"constructor\" ) ) {\n\t\tfsm = protoProps.constructor;\n\t} else {\n\t\t// The default machina constructor (when using inheritance) creates a\n\t\t// deep copy of the states/initialState values from the prototype and\n\t\t// extends them over the instance so that they'll be instance-level.\n\t\t// If an options arg (args[0]) is passed in, a states or intialState\n\t\t// value will be preferred over any data pulled up from the prototype.\n\t\tfsm = function( ...args ) {\n\t\t\targs[ 0 ] = args[ 0 ] || {};\n\t\t\tconst instanceStates = args[ 0 ].states || {};\n\t\t\tconst blendedState = _.merge( _.cloneDeep( machObj ), { states: instanceStates, } );\n\t\t\tblendedState.initialState = args[ 0 ].initialState || this.initialState; // eslint-disable-line no-invalid-this\n\t\t\t_.extend( args[ 0 ], blendedState );\n\t\t\tparent.apply( this, args ); // eslint-disable-line no-invalid-this\n\t\t};\n\t}\n\n\t// Inherit class (static) properties from parent.\n\t_.merge( fsm, parent );\n\n\t// Set the prototype chain to inherit from `parent`, without calling\n\t// `parent`'s constructor function.\n\tCtor.prototype = parent.prototype;\n\tfsm.prototype = new Ctor();\n\n\t// Add prototype properties (instance properties) to the subclass,\n\t// if supplied.\n\tif ( protoProps ) {\n\t\t_.extend( fsm.prototype, protoProps );\n\t\t_.merge( machObj, _.transform( protoProps, function( accum, val, key ) {\n\t\t\tif ( _machKeys.indexOf( key ) !== -1 ) {\n\t\t\t\taccum[ key ] = val;\n\t\t\t}\n\t\t} ) );\n\t}\n\n\t// Add static properties to the constructor function, if supplied.\n\tif ( staticProps ) {\n\t\t_.merge( fsm, staticProps );\n\t}\n\n\t// Correctly set child's `prototype.constructor`.\n\tfsm.prototype.constructor = fsm;\n\n\t// Set a convenience property in case the parent's prototype is needed later.\n\tfsm.__super__ = parent.prototype;\n\treturn fsm;\n};\n\n/* eslint-disable no-magic-numbers */\nfunction createUUID() {\n\tconst s = [];\n\tconst hexDigits = \"0123456789abcdef\";\n\tfor ( let i = 0; i < 36; i++ ) {\n\t\ts[ i ] = hexDigits.substr( Math.floor( Math.random() * 0x10 ), 1 );\n\t}\n\ts[ 14 ] = \"4\"; // bits 12-15 of the time_hi_and_version field to 0010\n\t/* jshint ignore:start */\n\ts[ 19 ] = hexDigits.substr( ( s[ 19 ] & 0x3 ) | 0x8, 1 ); // bits 6-7 of the clock_seq_hi_and_reserved to 01\n\t/* jshint ignore:end */\n\ts[ 8 ] = s[ 13 ] = s[ 18 ] = s[ 23 ] = \"-\";\n\treturn s.join( \"\" );\n}\n/* eslint-enable no-magic-numbers */\n\nmodule.exports = {\n\tcreateUUID,\n\textend,\n\tgetDefaultBehavioralOptions,\n\tgetDefaultOptions: getDefaultBehavioralOptions,\n\tgetDefaultClientMeta,\n\tgetChildFsmInstance,\n\tgetLeaklessArgs,\n\tlistenToChild,\n\tmakeFsmNamespace,\n};\n"]},"all":true}}