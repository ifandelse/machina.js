/*! For license information please see machina.min.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("lodash")):"function"==typeof define&&define.amd?define(["lodash"],e):"object"==typeof exports?exports.machina=e(require("lodash")):t.machina=e(t._)}(this,(function(t){return(()=>{var e={319:t=>{t.exports={NEXT_TRANSITION:"transition",HANDLING:"handling",HANDLED:"handled",NO_HANDLER:"nohandler",TRANSITION:"transition",TRANSITIONED:"transitioned",INVALID_STATE:"invalidstate",DEFERRED:"deferred",NEW_FSM:"newfsm"}},622:(t,e,n)=>{"use strict";var i=n(760),r=n.n(i);function o(){return{emit:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=e[0];this.eventListeners["*"]&&r().each(this.eventListeners["*"],function(t){if(this.useSafeEmit)try{t.apply(this,e)}catch(t){console&&void 0!==console.log&&console.log(t.stack)}else t.apply(this,e)}.bind(this)),this.eventListeners[i]&&r().each(this.eventListeners[i],function(t){if(this.useSafeEmit)try{t.apply(this,e.slice(1))}catch(t){console&&void 0!==console.log&&console.log(t.stack)}else t.apply(this,e.slice(1))}.bind(this))},on:function(t,e){var n=this;return n.eventListeners=n.eventListeners||{"*":[]},n.eventListeners[t]||(n.eventListeners[t]=[]),n.eventListeners[t].push(e),{eventName:t,callback:e,off:function(){n.off(t,e)}}},off:function(t,e){this.eventListeners=this.eventListeners||{"*":[]},t?this.eventListeners[t]=e?r().without(this.eventListeners[t],e):[]:this.eventListeners={}}}}var a=o(),s=n(319),c=n.n(s);function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var l,f=(l=0,function(){return"fsm.".concat(l++)});function p(){return{initialState:"uninitialized",eventListeners:{"*":[]},states:{},namespace:f(),useSafeEmit:!1,hierarchy:{},pendingDelegations:{}}}var h=["states","initialState"],d={createUUID:function(){for(var t=[],e="0123456789abcdef",n=0;n<36;n++)t[n]=e.substr(Math.floor(16*Math.random()),1);return t[14]="4",t[19]=e.substr(3&t[19]|8,1),t[8]=t[13]=t[18]=t[23]="-",t.join("")},extend:function(t,e){var n,i=this,o={},a=function(){};return n=t&&t.hasOwnProperty("constructor")?t.constructor:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e[0]=e[0]||{};var a=e[0].states||{},s=r().merge(r().cloneDeep(o),{states:a});s.initialState=e[0].initialState||this.initialState,r().extend(e[0],s),i.apply(this,e)},r().merge(n,i),a.prototype=i.prototype,n.prototype=new a,t&&(r().extend(n.prototype,t),r().merge(o,r().transform(t,(function(t,e,n){-1!==h.indexOf(n)&&(t[n]=e)})))),e&&r().merge(n,e),n.prototype.constructor=n,n.__super__=i.prototype,n},getDefaultBehavioralOptions:p,getDefaultOptions:p,getDefaultClientMeta:function(){return{inputQueue:[],targetReplayState:"",state:void 0,priorState:void 0,priorAction:"",currentAction:"",currentActionArgs:void 0,inExitHandler:!1}},getChildFsmInstance:function(t){if(t){var e={};return"object"===u(t)?t.factory?(e=t).instance=e.factory():e.factory=function(){return t}:"function"==typeof t&&(e.factory=t),e.instance=e.factory(),e}},listenToChild:function(t,e){return e.on("*",(function(e,n){var i;switch(e){case c().NO_HANDLER:n.ticket||n.delegated||n.namespace===t.namespace||(n.args[1].bubbling=!0),"_reset"!==n.inputType&&t.handle.apply(t,n.args);break;case c().HANDLING:(i=n.ticket)&&t.pendingDelegations[i]&&delete t.pendingDelegations[i],t.emit(e,n);break;default:t.emit(e,n)}}))},makeFsmNamespace:f};function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function m(t){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var g=a;function v(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=e[0];r().extend(this,i),r().defaults(this,d.getDefaultBehavioralOptions()),this.initialize.apply(this,e),g.emit(c().NEW_FSM,this)}function b(t){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}r().extend(v.prototype,{initialize:function(){},initClient:function(t){var e=this.initialState;if(!e)throw new Error("You must specify an initial state for this FSM");if(!this.states[e])throw new Error("The initial state specified does not exist in the states object.");this.transition(t,e)},configForState:function(t){var e,n=this.states[t];return r().each(this.hierarchy,(function(t){t&&"function"==typeof t.off&&t.off()})),n._child&&(n._child=d.getChildFsmInstance(n._child),e=n._child&&n._child.instance,this.hierarchy[e.namespace]=d.listenToChild(this,e)),e},ensureClientMeta:function(t){if("object"!==m(t))throw new Error("An FSM client must be an object.");return t.__machina__=t.__machina__||{},t.__machina__[this.namespace]||(t.__machina__[this.namespace]=r().cloneDeep(d.getDefaultClientMeta()),this.initClient(t)),t.__machina__[this.namespace]},buildEventPayload:function(t,e){return r().isPlainObject(e)?r().extend(e,{client:t,namespace:this.namespace}):{client:t,data:e||null,namespace:this.namespace}},getHandlerArgs:function(t,e){var n=t.slice(0),i=n[1];return"object"===m(i)&&n.splice(1,1,i.inputType),e?n:[n[0]].concat(n.slice(2))},getSystemHandlerArgs:function(t,e){return[e].concat(t)},handle:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=e[0],o=e[1],a=o;if(void 0===o)throw new Error("The input argument passed to the FSM's handle method is undefined. Did you forget to pass the input name?");"string"==typeof o&&(a={inputType:o,delegated:!1,ticket:void 0});var s=this.ensureClientMeta(i);"object"!==m(o)&&e.splice(1,1,a),s.currentActionArgs=e.slice(1);var u,l,f,p,h,y=s.state,g=this.states[y],v=!1;if(!s.inExitHandler)if(!(f=this.configForState(y))||this.pendingDelegations[a.ticket]||a.bubbling){a.ticket&&this.pendingDelegations[a.ticket]&&delete this.pendingDelegations[a.ticket],v="*"===(u=g[a.inputType]?a.inputType:"*"),l=g[u]||this[u]||this["*"],h="".concat(s.state,".").concat(u),s.currentAction=h;var b=this.buildEventPayload(i,{inputType:a.inputType,delegated:a.delegated,ticket:a.ticket});l?(this.emit(c().HANDLING,b),"function"==typeof l?p=l.apply(this,this.getHandlerArgs(e,v)):(p=l,this.transition(i,l)),this.emit(c().HANDLED,b)):this.emit(c().NO_HANDLER,r().extend({args:e},b)),s.priorAction=s.currentAction,s.currentAction="",s.currentActionArgs=void 0}else{var S;a.ticket=a.ticket||d.createUUID(),a.delegated=!0,this.pendingDelegations[a.ticket]={delegatedTo:f.namespace},p=(S=f).handle.apply(S,e)}return p},transition:function(t,e){var n,i=this.ensureClientMeta(t),r=i.state,o=this.states[r],a=this.states[e];if(!i.inExitHandler&&e!==r){if(a){n=this.configForState(e),o&&o._onExit&&(i.inExitHandler=!0,o._onExit.call(this,t),i.inExitHandler=!1),i.targetReplayState=e,i.priorState=r,i.state=e;var s=this.buildEventPayload(t,{fromState:i.priorState,action:i.currentAction,toState:e});if(this.emit(c().TRANSITION,s),a._onEnter){for(var u=arguments.length,l=new Array(u>2?u-2:0),f=2;f<u;f++)l[f-2]=arguments[f];a._onEnter.apply(this,this.getSystemHandlerArgs(l,t))}return this.emit(c().TRANSITIONED,s),n&&n.handle(t,"_reset"),void(i.targetReplayState===e&&this.processQueue(t,c().NEXT_TRANSITION))}this.emit(c().INVALID_STATE,this.buildEventPayload(t,{state:i.state,attemptedState:e}))}},deferUntilTransition:function(t,e){var n=this.ensureClientMeta(t),i=r().isArray(e)?e:e?[e]:void 0;if(n.currentActionArgs){var o={type:c().NEXT_TRANSITION,untilState:i,args:n.currentActionArgs};n.inputQueue.push(o);var a=this.buildEventPayload(t,{state:n.state,queuedArgs:o});this.emit(c().DEFERRED,a)}},deferAndTransition:function(t,e){this.deferUntilTransition(t,e),this.transition(t,e)},processQueue:function(t){var e=this.ensureClientMeta(t),n=r().filter(e.inputQueue,(function(t){return!t.untilState||r().includes(t.untilState,e.state)}));e.inputQueue=r().difference(e.inputQueue,n),r().each(n,function(e){var n;this.handle.apply(this,function(t){if(Array.isArray(t))return y(t)}(n=[t].concat(e.args))||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(n)||function(t,e){if(t){if("string"==typeof t)return y(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(t,e):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}.bind(this))},clearQueue:function(t,e){var n=this.ensureClientMeta(t);e?(r().each(n.inputQueue,(function(t){t.untilState=r().without(t.untilState,e)})),n.inputQueue=r().filter(n.inputQueue,(function(t){return 0!==t.untilState.length}))):n.inputQueue=[]},compositeState:function(t){var e=this.ensureClientMeta(t).state,n=this.states[e]._child&&this.states[e]._child.instance;return n&&(e+=".".concat(n.compositeState(t))),e}},o()),v.extend=d.extend;var S={constructor:function(){v.apply(this,arguments),this.ensureClientMeta()},initClient:function(){var t=this.initialState;if(!t)throw new Error("You must specify an initial state for this FSM");if(!this.states[t])throw new Error("The initial state specified does not exist in the states object.");this.transition(t)},ensureClientMeta:function(){return this._stamped||(this._stamped=!0,r().defaults(this,r().cloneDeep(d.getDefaultClientMeta())),this.initClient()),this},ensureClientArg:function(t){var e=t;return"object"!==b(e[0])||"inputType"in e[0]||e[0]===this?("object"!==b(e[0])||"object"===b(e[0])&&"inputType"in e[0])&&e.unshift(this):e.splice(0,1,this),e},getHandlerArgs:function(t,e){var n=t,i=n[1];return"object"===("undefined"==typeof inputType?"undefined":b(inputType))&&n.splice(1,1,i.inputType),e?n.slice(1):n.slice(2)},getSystemHandlerArgs:function(t){return t},buildEventPayload:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=this.ensureClientArg(e),o=i[1];return r().isPlainObject(o)?r().extend(o,{namespace:this.namespace}):{data:o||null,namespace:this.namespace}}};function A(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function _(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?A(Object(n),!0).forEach((function(e){E(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function E(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}r().each(["handle","transition","deferUntilTransition","processQueue","clearQueue"],(function(t){S[t]=function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=this.ensureClientArg(n);return v.prototype[t].apply(this,r)}})),S=v.extend(S),(t=n.hmd(t)).exports=_(_({},a),{},{Fsm:S,BehavioralFsm:v,utils:d,eventListeners:{newFsm:[]}})},760:e=>{"use strict";e.exports=t}},n={};function i(t){var r=n[t];if(void 0!==r)return r.exports;var o=n[t]={id:t,loaded:!1,exports:{}};return e[t](o,o.exports,i),o.loaded=!0,o.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.hmd=t=>((t=Object.create(t)).children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var r=i(622);return r.default})()}));
//# sourceMappingURL=machina.min.js.map